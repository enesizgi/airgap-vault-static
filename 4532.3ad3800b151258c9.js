"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4532],{42723:(w,g,o)=>{o.d(g,{K:()=>f});var d=o(20976),y=o(12714),l=o(84653),c=o(3323),p=o(34388),E=o(9527),P=o(51628),v=o(9288);let f=(()=>{class h{}return h.\u0275fac=function(S){return new(S||h)},h.\u0275mod=v.oAB({type:h}),h.\u0275inj=v.cJS({imports:[[c.Pc,P.D,y.ez,l.u5,p.aw,E.N,d.aD]]}),h})()},44532:(w,g,o)=>{o.r(g),o.d(g,{SecretGeneratePageModule:()=>H});var d=o(12714),y=o(84653),l=o(23345),c=o(3323),p=o(34388),E=o(42723),P=o(65949),v=o(20976),f=o(29416),h=o(2512);class S{constructor(s){this.durationSelector=s}call(s,e){return e.subscribe(new A(s,this.durationSelector))}}class A extends h.Ds{constructor(s,e){super(s),this.durationSelector=e,this.hasValue=!1}_next(s){if(this.value=s,this.hasValue=!0,!this.throttled){let e;try{const{durationSelector:i}=this;e=i(s)}catch(i){return this.destination.error(i)}const n=(0,h.ft)(e,new h.IY(this));!n||n.closed?this.clearThrottle():this.add(this.throttled=n)}}clearThrottle(){const{value:s,hasValue:e,throttled:n}=this;n&&(this.remove(n),this.throttled=void 0,n.unsubscribe()),e&&(this.value=void 0,this.hasValue=!1,this.destination.next(s))}notifyNext(){this.clearThrottle()}notifyComplete(){this.clearThrottle()}}var x=o(39722),D=o(39304);function M(r){return!(0,D.k)(r)&&r-parseFloat(r)+1>=0}var O=o(1183);function R(r){const{index:s,period:e,subscriber:n}=r;if(n.next(s),!n.closed){if(-1===e)return n.complete();r.index=s+1,this.schedule(r,e)}}var U=o(50653),t=o(9288);let B=(()=>{class r{constructor(e,n,i){this.ngZone=n,this.renderer=i,this.mousePos={x:0,y:0},this.lastPos=this.mousePos,this.canvas=e.nativeElement;const a=this.canvas.getContext("2d");a&&(this.context=a)}ngOnInit(){this.renderer.listen(this.canvas,"mousedown",e=>{this.lastPos=this.getMousePosition(this.canvas,e),this.mousePos=Object.assign({},this.lastPos),this.isDrawing=!0,this.startDrawing()}),this.renderer.listen(this.canvas,"touchstart",e=>{this.lastPos=this.getTouchPosition(this.canvas,e),this.mousePos=Object.assign({},this.lastPos),this.isDrawing=!0,this.startDrawing()}),this.renderer.listen(this.canvas,"mouseup",e=>{this.lastPos=this.getMousePosition(this.canvas,e),this.isDrawing=!1}),this.renderer.listen(this.canvas,"touchend",e=>{this.lastPos=this.getTouchPosition(this.canvas,e),this.isDrawing=!1}),this.renderer.listen(this.canvas,"mousemove",e=>{this.mousePos=this.getMousePosition(this.canvas,e)}),this.renderer.listen(this.canvas,"touchmove",e=>{this.mousePos=this.getTouchPosition(this.canvas,e)})}startDrawing(){!this.isDrawing||this.ngZone.runOutsideAngular(()=>{requestAnimationFrame(()=>{this.renderEntropyDrawing()})})}getMousePosition(e,n){const i=e.getBoundingClientRect();return{x:n.clientX-i.left,y:n.clientY-i.top}}getTouchPosition(e,n){const i=e.getBoundingClientRect();return n.touches[0]?{x:n.touches[0].clientX-i.left,y:n.touches[0].clientY-i.top}:this.lastPos}renderEntropyDrawing(){this.context.strokeStyle="rgb(255, 255, 255)",this.context.moveTo(this.lastPos.x,this.lastPos.y),this.context.lineTo(this.mousePos.x,this.mousePos.y),this.lastPos=this.mousePos,this.context.stroke(),this.startDrawing()}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(t.SBq),t.Y36(t.R0b),t.Y36(t.Qsj))},r.\u0275dir=t.lG2({type:r,selectors:[["","airgapTraceInput",""]]}),r})();const Y=["canvas"],L=window.URL.createObjectURL(new Blob([U.Z])),b=new Worker(L);let V=(()=>{class r{constructor(e){this.renderer=e,this.cursorSize=2,this.randomFactorInPercent=10,this.cursorColor="white",this.collectedEntropyPercentage=0,this.isDrawing=!1,this.entropyObservable=new x.y(n=>{b.onmessage=i=>{this.collectedEntropyPercentage+=i.data.entropyMeasure,n.next({entropyHex:i.data.entropyHex})},this.handler=i=>{const a=this.arrayBufferFromIntArray(i);b.postMessage({entropyBuffer:a},[a])}})}ngAfterViewInit(){this.canvas=this.canvasRef.nativeElement,this.initCanvas()}initCanvas(){if(!this.isCanvasReady())return void setTimeout(()=>{this.initCanvas()},50);this.canvas.setAttribute("height",`${this.canvas.parentElement.getBoundingClientRect().height}px`),this.canvas.setAttribute("width",`${this.canvas.parentElement.getBoundingClientRect().width}px`);const e=this.canvas.getContext("2d");e&&(this.context=e),this.context.fillStyle=this.cursorColor,this.rectangle=this.canvas.getBoundingClientRect()}isCanvasReady(){return!!this.canvas.parentElement&&this.canvas.parentElement.getBoundingClientRect().height>0}start(){return this.collectedEntropyPercentage=0,new Promise(e=>{this.renderer.listen(this.canvas,"mousedown",()=>{this.isDrawing=!0}),this.renderer.listen(this.canvas,"touchstart",()=>{this.isDrawing=!0}),this.renderer.listen(this.canvas,"mouseup",()=>{this.isDrawing=!1}),this.renderer.listen(this.canvas,"touchend",()=>{this.isDrawing=!1}),this.renderer.listen(this.canvas,"mousemove",n=>{this.isDrawing&&this.collectEntropy(n.clientX,n.clientY)}),this.renderer.listen(this.canvas,"touchmove",n=>{this.isDrawing&&this.collectEntropy(n.touches[0].clientX,n.touches[0].clientY)}),e()})}stop(){return new Promise(e=>{this.isDrawing=!1,e()})}collectEntropy(e,n){const i=Math.ceil((e-this.rectangle.left)/(this.rectangle.right-this.rectangle.left)*this.canvas.width),a=Math.ceil((n-this.rectangle.top)/(this.rectangle.bottom-this.rectangle.top)*this.canvas.height)-56;if(this.getRandomIntInclusive(0,100)<=this.randomFactorInPercent){const m=window.performance&&window.performance.now&&window.performance.timing&&window.performance.timing.navigationStart?window.performance.now()+window.performance.timing.navigationStart:Date.now();this.handler&&this.handler([i,a,m])}}getEntropyUpdateObservable(){return this.entropyObservable}getRandomIntInclusive(e,n){const i=new Uint32Array(1);window.crypto.getRandomValues(i);const a=i[0]/4294967296,m=Math.ceil(e),T=Math.floor(n);return Math.floor(a*(T-m+1))+m}arrayBufferFromIntArray(e){const n=new ArrayBuffer(2*e.length),i=new Uint8Array(n);for(let a=0;a<e.length;a++)i[a]=Math.abs(1e4*e[a]);return n}getCollectedEntropyPercentage(){return this.collectedEntropyPercentage/10}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(t.Qsj))},r.\u0275cmp=t.Xpm({type:r,selectors:[["airgap-touch-entropy"]],viewQuery:function(e,n){if(1&e&&t.Gf(Y,7),2&e){let i;t.iGM(i=t.CRH())&&(n.canvasRef=i.first)}},inputs:{cursorSize:"cursorSize",randomFactorInPercent:"randomFactorInPercent",cursorColor:"cursorColor"},decls:6,vars:3,consts:[[1,"ion-align-items-center","ion-justify-content-center","touch-entropy__container"],["airgapTraceInput",""],["canvas",""]],template:function(e,n){1&e&&(t.TgZ(0,"ion-row",0)(1,"p"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._UZ(4,"canvas",1,2),t.qZA()),2&e&&(t.xp6(2),t.Oqu(t.lcZ(3,1,"touch-entropy.text")))},directives:[c.Nd,B],pipes:[p.X$],styles:[".touch-entropy__container[_ngcontent-%COMP%]{position:relative;height:25vh}.touch-entropy__container[_ngcontent-%COMP%]   canvas[_ngcontent-%COMP%]{position:absolute;width:100%;height:100%;border:1px solid;border-radius:4px}"]}),r})();var G=o(52971),N=o(7563),_=o(34753),W=o(30849),u=o(55956),F=o(8518),j=o(27204);let K=(()=>{class r{constructor(){this.maxValue=1,this.value=0,this.progressInPercent=0}ngOnChanges(){this.progressInPercent=this.value>this.maxValue?100:Math.floor(this.value/this.maxValue*100)}}return r.\u0275fac=function(e){return new(e||r)},r.\u0275cmp=t.Xpm({type:r,selectors:[["airgap-entropy-progress"]],inputs:{maxValue:"maxValue",value:"value"},features:[t.TTD],decls:2,vars:1,template:function(e,n){1&e&&(t.TgZ(0,"div"),t._uU(1),t.qZA()),2&e&&(t.xp6(1),t.hij("",n.progressInPercent,"%"))},styles:[""]}),r})();const Q=["videoElement"],J=["touchEntropy"];function z(r,s){1&r&&t._UZ(0,"video",19,20)}const X=[{path:"",component:(()=>{class r{constructor(e,n,i,a,m,T,$,q){this.gyroService=e,this.entropyService=n,this.cameraService=i,this.audioService=a,this.navigationService=m,this.platform=T,this.changeDetectorRef=$,this.permissionsService=q,this.isBrowser=!1,this.cameraEnabled=!0,this.audioEnabled=!0,this.gyroEnabled=!0,this.touchEnabled=!0,this.ENTROPY_STARTUP_TIME=5,this.startupTimeWaited=!1,this.entropy={isFull:!1},this.isBrowser=!this.platform.is("hybrid"),this.isBrowser||this.cameraService.setTransparentElementsByTags("ion-toolbar","ion-content"),setTimeout(()=>{this.startupTimeWaited=!0,this.checkEntropySourceStatus()},1e3*this.ENTROPY_STARTUP_TIME)}checkEntropySourceStatus(){this.startupTimeWaited&&(this.audioEnabled=0!==this.audioService.getCollectedEntropyPercentage(),this.cameraEnabled=0!==this.cameraService.getCollectedEntropyPercentage(),this.gyroEnabled=0!==this.gyroService.getCollectedEntropyPercentage())}ngOnInit(){return(0,P.mG)(this,void 0,void 0,function*(){yield this.platform.ready(),this.isBrowser&&this.cameraService.setVideoElement(this.videoElement),this.cameraService.viewWillEnter(),yield this.permissionsService.requestPermissions([v.r3.CAMERA,v.r3.MICROPHONE]),this.initEntropy()})}initEntropy(){this.entropyService.addEntropySource(this.cameraService),this.entropyService.addEntropySource(this.audioService),this.entropyService.addEntropySource(this.gyroService),this.entropyService.addEntropySource(this.touchEntropy),this.entropyService.startEntropyCollection().then(()=>{this.entropyService.getEntropyUpdateObservable().pipe(function Z(r,s=f.P){return function C(r){return function(e){return e.lift(new S(r))}}(()=>function I(r=0,s,e){let n=-1;return M(s)?n=Number(s)<1?1:Number(s):(0,O.K)(s)&&(e=s),(0,O.K)(e)||(e=f.P),new x.y(i=>{const a=M(r)?r:+r-e.now();return e.schedule(R,a,{index:0,period:n,subscriber:i})})}(r,s))}(200)).subscribe(()=>{this.checkEntropy()})}).catch((0,u.a1)(u.qj.ENTROPY_COLLECTION))}checkEntropy(){this.changeDetectorRef.detectChanges(),this.checkEntropySourceStatus();const n=[this.audioEnabled,this.cameraEnabled,this.gyroEnabled,this.touchEnabled].reduce((i,a)=>i+(a?100:0),0);Math.min(100,this.audioService.getCollectedEntropyPercentage())+Math.min(100,this.cameraService.getCollectedEntropyPercentage())+Math.min(100,this.gyroService.getCollectedEntropyPercentage())+Math.min(100,this.touchEntropy.getCollectedEntropyPercentage())>=n&&(this.entropy.isFull=!0)}ionViewWillLeave(){this.cameraService.viewWillLeave()}ionViewDidLeave(){this.entropyService.stopEntropyCollection().catch((0,u.a1)(u.qj.ENTROPY_COLLECTION))}goToSecretRulesPage(){this.entropyService.getEntropyAsHex().then(e=>{const n=new G.r(e);this.navigationService.routeWithState("secret-rules",{secret:n}).catch((0,u.a1)(u.qj.IONIC_NAVIGATION))}).catch((0,u.a1)(u.qj.ENTROPY_COLLECTION))}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(F.l),t.Y36(W.l),t.Y36(_.e),t.Y36(N.J),t.Y36(j.f),t.Y36(c.t4),t.Y36(t.sBO),t.Y36(v.qQ))},r.\u0275cmp=t.Xpm({type:r,selectors:[["airgap-secret-generate"]],viewQuery:function(e,n){if(1&e&&(t.Gf(Q,5),t.Gf(J,7)),2&e){let i;t.iGM(i=t.CRH())&&(n.videoElement=i.first),t.iGM(i=t.CRH())&&(n.touchEntropy=i.first)}},decls:35,vars:28,consts:[[1,"ion-no-border"],["slot","start"],["defaultHref","/secret-setup"],[1,"ion-padding"],["touchEntropy",""],["id","entropy-description"],[1,"ion-padding-top"],[1,"ion-text-center"],["color","white","src","assets/icons/md-videocam.svg"],["id","entropy-video",3,"maxValue","value"],["color","white","src","assets/icons/md-mic.svg"],["id","entropy-audio",3,"maxValue","value"],["color","white","src","assets/icons/md-screen_rotation.svg"],["id","entropy-gyro",3,"maxValue","value"],["color","white","src","assets/icons/md-touch_app.svg"],["id","entropy-touch",3,"maxValue","value"],["style","width: 100%",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["color","primary","shape","round",3,"disabled","click"],[2,"width","100%"],["videoElement",""]],template:function(e,n){if(1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),t._UZ(3,"ion-back-button",2),t.qZA()()(),t.TgZ(4,"ion-content",3)(5,"h1"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"p"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t._UZ(11,"airgap-touch-entropy",null,4)(13,"div",5),t.TgZ(14,"p",6),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"ion-row")(18,"ion-col",7),t._UZ(19,"ion-icon",8)(20,"airgap-entropy-progress",9),t.qZA(),t.TgZ(21,"ion-col",7),t._UZ(22,"ion-icon",10)(23,"airgap-entropy-progress",11),t.qZA(),t.TgZ(24,"ion-col",7),t._UZ(25,"ion-icon",12)(26,"airgap-entropy-progress",13),t.qZA(),t.TgZ(27,"ion-col",7),t._UZ(28,"ion-icon",14)(29,"airgap-entropy-progress",15),t.qZA()(),t.YNc(30,z,2,0,"video",16),t.TgZ(31,"ion-fab",17)(32,"ion-button",18),t.NdJ("click",function(){return n.goToSecretRulesPage()}),t._uU(33),t.ALo(34,"translate"),t.qZA()()()),2&e){const i=t.MAs(12);t.xp6(6),t.Oqu(t.lcZ(7,20,"secret-generate.heading")),t.xp6(3),t.Oqu(t.lcZ(10,22,"secret-generate.text")),t.xp6(6),t.Oqu(t.lcZ(16,24,"secret-generate.description")),t.xp6(3),t.Udp("opacity",n.cameraEnabled?"1":"0.2"),t.xp6(2),t.Q6J("maxValue",100)("value",n.cameraService.getCollectedEntropyPercentage()),t.xp6(1),t.Udp("opacity",n.audioEnabled?"1":"0.2"),t.xp6(2),t.Q6J("maxValue",100)("value",n.audioService.getCollectedEntropyPercentage()),t.xp6(1),t.Udp("opacity",n.gyroEnabled?"1":"0.2"),t.xp6(2),t.Q6J("maxValue",100)("value",n.gyroService.getCollectedEntropyPercentage()),t.xp6(3),t.Q6J("maxValue",100)("value",i.getCollectedEntropyPercentage()),t.xp6(1),t.Q6J("ngIf",n.isBrowser),t.xp6(2),t.Q6J("disabled",!n.entropy.isFull),t.xp6(1),t.hij(" ",t.lcZ(34,26,"secret-generate.continue_label")," ")}},directives:[c.Gu,c.sr,c.Sm,c.oU,c.cs,c.W2,V,c.Nd,c.wI,c.gu,K,d.O5,c.IJ,c.YG],pipes:[p.X$],styles:["ion-content[_ngcontent-%COMP%]{--overflow: hidden}.bar-button[_ngcontent-%COMP%], .content[_ngcontent-%COMP%]{color:#fff}div#overlay[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;min-width:100%;min-height:100%;width:auto;height:auto;z-index:-99;transform:translate(-50%) translateY(-50%);background:white}video#bgvid[_ngcontent-%COMP%]{position:fixed;top:50%;left:50%;min-width:100%;min-height:100%;width:auto;height:auto;z-index:-100;transform:translate(-50%) translateY(-50%);background-size:cover}"]}),r})()}];let H=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[[d.ez,y.u5,c.Pc,l.Bz.forChild(X),p.aw,E.K]]}),r})()},51628:(w,g,o)=>{o.d(g,{D:()=>y});var d=o(9288);let y=(()=>{class l{}return l.\u0275fac=function(p){return new(p||l)},l.\u0275mod=d.oAB({type:l}),l.\u0275inj=d.cJS({imports:[[]]}),l})()}}]);