"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3698],{59362:(N,T,i)=>{i.r(T),i.d(T,{AccountsListPageModule:()=>J});var u=i(12714),y=i(84653),o=i(3323),f=i(23345),x=i(65949),p=i(88061),O=i(52895),E=i(39141),v=i(55956),P=i(45499),I=i(27204),h=i(56810),L=i(62984),t=i(9288),s=i(34388),l=i(20976);function a(n,_){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item",11),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).navigateToRecoverySettings()}),t._UZ(1,"ion-icon",12),t.TgZ(2,"ion-label",13)(3,"h3")(4,"strong"),t._uU(5),t.ALo(6,"translate"),t.qZA()(),t.TgZ(7,"p"),t._uU(8),t.ALo(9,"translate"),t.qZA()()()}2&n&&(t.xp6(5),t.Oqu(t.lcZ(6,2,"tab-wallets.generate-recovery-key.title")),t.xp6(3),t.Oqu(t.lcZ(9,4,"tab-wallets.generate-recovery-key.description")))}function d(n,_){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"ion-item")(2,"ion-checkbox",16),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().$implicit;return t.oxw(3).onWalletSelected(r)}),t.qZA(),t.TgZ(3,"airgap-account-item",17),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().$implicit;return t.oxw(3).goToReceiveAddress(r)}),t.qZA()(),t.BQk()}if(2&n){const e=t.oxw().$implicit;t.xp6(3),t.Q6J("wallet",e)}}function m(n,_){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"airgap-account-item",17),t.NdJ("click",function(){t.CHM(e);const r=t.oxw().$implicit;return t.oxw(3).goToReceiveAddress(r)}),t.qZA(),t.BQk()}if(2&n){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("wallet",e)}}function M(n,_){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"ion-item-sliding"),t.YNc(2,d,4,1,"ng-container",9),t.YNc(3,m,2,1,"ng-container",9),t.TgZ(4,"ion-item-options",15)(5,"ion-item-option",2),t.NdJ("click",function(){const g=t.CHM(e).$implicit;return t.oxw(3).delete(g)}),t.TgZ(6,"ion-item-option"),t._UZ(7,"ion-icon",5),t.qZA()()()(),t.BQk()}if(2&n){const e=t.oxw(3);t.xp6(2),t.Q6J("ngIf",e.deleteView),t.xp6(1),t.Q6J("ngIf",!e.deleteView)}}function S(n,_){1&n&&(t.ynx(0),t.TgZ(1,"ion-row")(2,"ion-col",18),t._UZ(3,"img",19),t.qZA()(),t.TgZ(4,"ion-row")(5,"ion-col",20)(6,"strong"),t._uU(7),t.ALo(8,"translate"),t.qZA()()(),t.BQk()),2&n&&(t.xp6(7),t.Oqu(t.lcZ(8,1,"tab-wallets.empty-state_text")))}function Z(n,_){if(1&n&&(t.ynx(0),t.TgZ(1,"ion-list"),t.YNc(2,M,8,2,"ng-container",14),t.qZA(),t.YNc(3,S,9,3,"ng-container",9),t.BQk()),2&n){const e=_.ngIf;t.xp6(2),t.Q6J("ngForOf",e),t.xp6(1),t.Q6J("ngIf",0===e.length)}}function W(n,_){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"ion-button",21),t.NdJ("click",function(r){return t.CHM(e),t.oxw(2).removeWallets(),r.stopPropagation()}),t._UZ(2,"ion-icon",22),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.BQk()}2&n&&(t.xp6(3),t.hij(" ",t.lcZ(4,1,"tab-wallets.delete-accounts_label")," "))}function b(n,_){if(1&n){const e=t.EpF();t.ynx(0),t.TgZ(1,"ion-fab-button",23),t._UZ(2,"ion-icon",24),t.qZA(),t.TgZ(3,"ion-fab-list",25)(4,"ion-fab-button",26),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).syncWallets()}),t._UZ(5,"ion-icon",27),t.qZA(),t.TgZ(6,"ion-fab-button",26),t.NdJ("click",function(){return t.CHM(e),t.oxw(2).addWallet()}),t._UZ(7,"ion-icon",28),t.qZA()(),t.BQk()}}const B=function(n){return{status:n}};function G(n,_){if(1&n&&(t.TgZ(0,"ion-content",7),t.YNc(1,a,10,6,"ion-item",8),t.YNc(2,Z,4,2,"ng-container",9),t.ALo(3,"async"),t.ALo(4,"walletFilter"),t.ALo(5,"async"),t.TgZ(6,"ion-fab",10),t.YNc(7,W,5,3,"ng-container",9),t.YNc(8,b,8,0,"ng-container",9),t.qZA()()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.isAndroid&&e.secret&&!e.secret.hasRecoveryKey),t.xp6(1),t.Q6J("ngIf",e.wallets$&&t.lcZ(3,4,t.xi3(4,6,t.lcZ(5,9,e.wallets$),t.VKq(11,B,e.AirGapWalletStatus.ACTIVE)))),t.xp6(5),t.Q6J("ngIf",e.deleteView),t.xp6(1),t.Q6J("ngIf",!e.deleteView)}}const R=[{path:"",component:(()=>{class n{constructor(e,c,r,g,A,w,C){this.platform=e,this.navigationService=c,this.modeService=r,this.alertCtrl=g,this.translateService=A,this.secretsService=w,this.router=C,this.deleteView=!1,this.wallets$=new O.X([]),this.selectedWallets=[],this.AirGapWalletStatus=p.AirGapWalletStatus,this.isAndroid=this.platform.is("android")}ionViewWillEnter(){var e,c;if(this.secret=null===(c=null===(e=this.navigationService)||void 0===e?void 0:e.getState())||void 0===c?void 0:c.secret,!this.secret)throw this.router.navigate(["/"]),new Error("[AccountsListPage]: No secret found! Navigating to home page.");this.loadWallets()}loadWallets(){var e;return(0,x.mG)(this,void 0,void 0,function*(){const r=(yield Promise.all([...null===(e=this.secret)||void 0===e?void 0:e.wallets].map(g=>(0,x.mG)(this,void 0,void 0,function*(){return[yield g.protocol.getName(),g]})))).sort((g,A)=>g[0].localeCompare(A[0])).map(([g,A])=>A);this.wallets$.next(r)})}goToReceiveAddress(e){this.navigationService.routeWithState("/account-address",{wallet:e,secret:this.secret}).catch((0,v.a1)(v.qj.IONIC_NAVIGATION))}syncWallets(){return(0,x.mG)(this,void 0,void 0,function*(){yield(yield this.modeService.strategy()).syncAll()})}addWallet(){this.navigationService.routeWithState("/account-add",{secret:this.secret}).catch((0,v.a1)(v.qj.IONIC_NAVIGATION))}goToEditSecret(e){this.navigationService.routeWithState("/secret-edit",{secret:e}).catch((0,v.a1)(v.qj.IONIC_NAVIGATION))}navigateToRecoverySettings(){this.navigationService.routeWithState("/secret-edit",{secret:this.secret,action:L.S.SET_RECOVERY_KEY}).catch((0,v.a1)(v.qj.IONIC_NAVIGATION))}delete(e){this.translateService.get(["wallet-edit-delete-popover.account-removal_alert.title","wallet-edit-delete-popover.account-removal_alert.text","wallet-edit-delete-popover.account-removal_alert.cancel_label","wallet-edit-delete-popover.account-removal_alert.delete_label"]).pipe((0,E.P)()).subscribe(c=>(0,x.mG)(this,void 0,void 0,function*(){const r=c["wallet-edit-delete-popover.account-removal_alert.title"],g=c["wallet-edit-delete-popover.account-removal_alert.text"],A=c["wallet-edit-delete-popover.account-removal_alert.cancel_label"],w=c["wallet-edit-delete-popover.account-removal_alert.delete_label"];(yield this.alertCtrl.create({header:r,message:g,buttons:[{text:A,role:"cancel"},{text:w,handler:()=>{this.secretsService.removeWallet(e).catch((0,v.a1)(v.qj.SECURE_STORAGE)),this.loadWallets()}}]})).present().catch((0,v.a1)(v.qj.IONIC_ALERT))}))}onWalletSelected(e){var c;if(null===(c=this.selectedWallets)||void 0===c?void 0:c.includes(e)){const r=this.selectedWallets.indexOf(e);r>-1&&(this.selectedWallets=this.selectedWallets.splice(r,1))}else this.selectedWallets.push(e)}removeWallets(){return(0,x.mG)(this,void 0,void 0,function*(){yield this.secretsService.removeWallets(this.selectedWallets),this.loadWallets(),this.toggleDeleteView()})}toggleDeleteView(){this.deleteView=!this.deleteView}navigateToSecretsTab(){this.navigationService.routeBack("tabs/tab-secrets")}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(o.t4),t.Y36(I.f),t.Y36(P.d),t.Y36(o.Br),t.Y36(s.sK),t.Y36(h.R),t.Y36(f.F0))},n.\u0275cmp=t.Xpm({type:n,selectors:[["airgap-accounts-list"]],decls:12,vars:4,consts:[[1,"ion-no-border"],["slot","start"],[3,"click"],["name","arrow-back"],["slot","primary"],["slot","icon-only","name","trash"],["class","ion-padding-horizontal",4,"ngIf"],[1,"ion-padding-horizontal"],["lines","none","detail","true","class","ion-margin-vertical","color","warning",3,"click",4,"ngIf"],[4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["lines","none","detail","true","color","warning",1,"ion-margin-vertical",3,"click"],["name","exit","slot","start","color","dark"],["color","dark",1,"ion-text-wrap"],[4,"ngFor","ngForOf"],["side","end"],["slot","start",3,"click"],[3,"wallet","click"],["size","12",1,"empty-list","content--align__center-center"],["src","./assets/img/no-wallet-added-onboarding.svg",1,"empty-img"],["size","12"],["color","secondary","shape","round",3,"click"],["slot","start","name","trash"],["color","secondary"],["name","chevron-up-outline"],["side","top"],["color","secondary",3,"click"],["name","sync-outline"],["name","add"]],template:function(e,c){1&e&&(t.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1)(3,"ion-button",2),t.NdJ("click",function(){return c.navigateToSecretsTab()}),t._UZ(4,"ion-icon",3),t.qZA()(),t.TgZ(5,"ion-title"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"ion-buttons",4)(9,"ion-button",2),t.NdJ("click",function(){return c.toggleDeleteView()}),t._UZ(10,"ion-icon",5),t.qZA()()()(),t.YNc(11,G,9,13,"ion-content",6)),2&e&&(t.xp6(6),t.Oqu(t.lcZ(7,2,"tab-wallets.title")),t.xp6(5),t.Q6J("ngIf",c.wallets$))},directives:[o.Gu,o.sr,o.Sm,o.YG,o.gu,o.wd,u.O5,o.W2,o.Ie,o.Q$,o.q_,u.sg,o.td,o.nz,o.w,l.vq,o.IK,o.u8,o.Nd,o.wI,o.IJ,o.W4,o.zq],pipes:[s.X$,u.Ov,l.fO],styles:[".empty-img[_ngcontent-%COMP%]{width:75%;opacity:.8}"]}),n})()}];let U=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[f.Bz.forChild(R)],f.Bz]}),n})();var D=i(51628),F=i(42723);let J=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[[u.ez,y.u5,o.Pc,F.K,U,s.aw,D.D,l.aD]]}),n})()},13187:(N,T,i)=>{i.d(T,{H:()=>I});var u=i(65949),y=i(88061),o=i(90544),f=i(47898),x=i(52971),p=i(2853),O=i(55956),E=i(27204),v=i(56810),P=i(9288);let I=(()=>{class h{constructor(t,s){this.secretsService=t,this.navigationService=s}runSecretsMigration(t){return(0,u.mG)(this,void 0,void 0,function*(){return new Promise((s,l)=>{t.every(p.e)?s():this.navigateToMigrationPage({secrets:t}).then(s).catch(l)})})}runWalletsMigration(t){return(0,u.mG)(this,void 0,void 0,function*(){return new Promise((s,l)=>{t.every(p.l)?s():this.navigateToMigrationPage({wallets:t}).then(s).catch(l)})})}navigateToMigrationPage(t){return(0,u.mG)(this,void 0,void 0,function*(){return new Promise((s,l)=>{this.navigationService.routeWithState("/migration",Object.assign(Object.assign({},t),{onSuccess:s,onError:l})).catch(a=>{(0,O.a1)(O.qj.IONIC_NAVIGATION)(a),l(a)})})})}filterMigratedSecrets(t){return t.every(p.e)?[t,!0]:[t.filter(p.e),!1]}filterMigratedWallets(t){return t.every(p.l)?[t,!0]:[t.filter(p.l),!1]}deepFilterMigratedSecretsAndWallets(t){return(0,u.mG)(this,void 0,void 0,function*(){return t.every(p.e)?[t,!0]:[(yield Promise.all(t.map(l=>(0,u.mG)(this,void 0,void 0,function*(){if(!l.fingerprint)return;const[a]=this.filterMigratedWallets(l.wallets);if(0===a.length)return;const d=x.r.init(l);return d.wallets=a,d})))).filter(l=>void 0!==l),!1]})}migrateSecret(t,s={}){return(0,u.mG)(this,void 0,void 0,function*(){const a=Object.assign(Object.assign({},{persist:!1}),s);if(void 0===t.fingerprint){let d=a.mnemonic;if(void 0===d){const Z=yield this.secretsService.retrieveEntropyForSecret(t);d=(0,f.entropyToMnemonic)(Z)}const m=yield(0,f.mnemonicToSeed)(d),S=(0,o.fromSeed)(m).fingerprint.toString("hex");t.fingerprint=S}a.persist&&(yield this.secretsService.addOrUpdateSecret(t,{setActive:!1}))})}migrateWallet(t,s){return(0,u.mG)(this,void 0,void 0,function*(){const a=Object.assign(Object.assign({},{bip39Passphrase:"",persist:!1}),s);if(t.masterFingerprint&&!a.persist)return;let m,d=a.mnemonic;if((void 0===d||a.persist)&&(m=this.secretsService.findByPublicKey(t.publicKey)),void 0===d&&void 0!==m){const b=yield this.secretsService.retrieveEntropyForSecret(m);d=(0,f.entropyToMnemonic)(b)}else if(void 0===d)return;if((yield t.protocol.getPublicKeyFromMnemonic(d,t.derivationPath,a.bip39Passphrase))!==t.publicKey)throw new Error("Invalid BIP-39 Passphrase");const S=yield(0,f.mnemonicToSeed)(d,a.bip39Passphrase),W=(0,o.fromSeed)(S).fingerprint.toString("hex");t.masterFingerprint=W,t.status=y.AirGapWalletStatus.ACTIVE,a.persist&&void 0!==m&&(yield this.migrateSecret(m,{mnemonic:a.mnemonic,persist:a.persist}))})}}return h.\u0275fac=function(t){return new(t||h)(P.LFG(v.R),P.LFG(E.f))},h.\u0275prov=P.Yz7({token:h,factory:h.\u0275fac,providedIn:"root"}),h})()},2853:(N,T,i)=>{function u(o){return o.fingerprint&&o.wallets.every(y)}function y(o){return!!o.masterFingerprint}i.d(T,{e:()=>u,l:()=>y})}}]);