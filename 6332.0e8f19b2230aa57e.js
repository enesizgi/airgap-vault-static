"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6332],{42723:(O,x,s)=>{s.d(x,{K:()=>y});var c=s(20976),m=s(12714),h=s(84653),v=s(3323),a=s(34388),f=s(9527),A=s(51628),_=s(9288);let y=(()=>{class g{}return g.\u0275fac=function(P){return new(P||g)},g.\u0275mod=_.oAB({type:g}),g.\u0275inj=_.cJS({imports:[[v.Pc,A.D,m.ez,h.u5,a.aw,f.N,c.aD]]}),g})()},56332:(O,x,s)=>{s.r(x),s.d(x,{TransactionSignedPageModule:()=>z});var c=s(20976),m=s(12714),h=s(84653),v=s(23345),a=s(3323),f=s(34388),A=s(42723),_=s(55956),y=s(27204),g=s(65949),S=s(88061),P=s(53070),T=s(48026),n=s(9288);let M=(()=>{class e{getTokenTransferDetailsFromSigned(t,o){return(0,g.mG)(this,void 0,void 0,function*(){const i=c.$c.find(l=>l.contractAddress.toLowerCase()===t.to[0].toLowerCase());if(i){const p=yield new T.GenericERC20(new T.EthereumERC20ProtocolOptions(new T.EthereumProtocolNetwork,new T.EthereumERC20ProtocolConfig(i.symbol,i.name,i.marketSymbol,i.identifier,i.contractAddress,i.decimals))).getTransactionDetailsFromSigned(o);if(1!==p.length)throw Error("TokenTransferDetails returned more than 1 transaction!");return p[0]}return t})}getTokenTransferDetails(t,o){return(0,g.mG)(this,void 0,void 0,function*(){const i=c.$c.find(l=>l.contractAddress.toLowerCase()===t.to[0].toLowerCase());if(i){const p=yield new T.GenericERC20(new T.EthereumERC20ProtocolOptions(new T.EthereumProtocolNetwork,new T.EthereumERC20ProtocolConfig(i.symbol,i.name,i.marketSymbol,i.identifier,i.contractAddress,i.decimals))).getTransactionDetails(o);if(1!==p.length)throw Error("TokenTransferDetails returned more than 1 transaction!");return p[0]}return t})}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275prov=n.Yz7({token:e,factory:e.\u0275fac,providedIn:"root"}),e})();var D=s(56810),w=s(91227),k=s(62883);const E=function(e){return{protocol:e,maxDigits:void 0}},R=function(e){return{protocol:e}};function I(e,r){if(1&e&&(n.ynx(0),n.TgZ(1,"ion-row",2)(2,"ion-col",3)(3,"h5"),n._uU(4),n.ALo(5,"async"),n.ALo(6,"amountConverter"),n.qZA()(),n.TgZ(7,"ion-col",3)(8,"h5"),n._uU(9),n.qZA()(),n.TgZ(10,"ion-col",3)(11,"h5"),n._uU(12),n.ALo(13,"async"),n.ALo(14,"feeConverter"),n.qZA()(),n.TgZ(15,"ion-col",4)(16,"small"),n._uU(17,"Amount"),n.qZA()(),n.TgZ(18,"ion-col",4)(19,"small"),n._uU(20,"Operations"),n.qZA()(),n.TgZ(21,"ion-col",4)(22,"small"),n._uU(23,"Fee"),n.qZA()()(),n.BQk()),2&e){const t=n.oxw();n.xp6(4),n.hij(" ",n.lcZ(5,3,n.xi3(6,5,t.aggregatedInfo.totalAmount.toFixed(),n.VKq(13,E,t.airGapTxs[0].protocolIdentifier)))," "),n.xp6(5),n.Oqu(t.aggregatedInfo.numberOfTxs),n.xp6(3),n.Oqu(n.lcZ(13,8,n.xi3(14,10,t.aggregatedInfo.totalFees.toFixed(),n.VKq(15,R,t.airGapTxs[0].protocolIdentifier))))}}function N(e,r){if(1&e&&(n.ynx(0),n._UZ(1,"airgap-transaction-warning",5)(2,"airgap-from-to",6),n.BQk()),2&e){const t=r.$implicit;n.xp6(1),n.Q6J("transaction",t),n.xp6(1),n.Q6J("transaction",t)("hideNetwork",!0)}}function G(e,r){if(1&e){const t=n.EpF();n.ynx(0),n.TgZ(1,"div",7)(2,"p"),n._uU(3,"This address is not in your address book:"),n.qZA(),n.TgZ(4,"div",8),n._UZ(5,"airgap-identicon",9),n.TgZ(6,"span"),n._uU(7),n.qZA()(),n.TgZ(8,"p"),n._uU(9,"Do you want to add it?"),n.qZA(),n.TgZ(10,"div",10)(11,"ion-button",11),n.NdJ("click",function(){const l=n.CHM(t).$implicit;return n.oxw().onClickDontAddContact(l)}),n._uU(12,"No"),n.qZA(),n.TgZ(13,"ion-button",11),n.NdJ("click",function(){const l=n.CHM(t).$implicit;return n.oxw().onClickAddContact(l)}),n._uU(14,"Yes"),n.qZA()(),n.TgZ(15,"ion-button",12),n.NdJ("click",function(){return n.CHM(t),n.oxw().onClickDisableContact()}),n._uU(16,"No, disable address book feature"),n.qZA()(),n.BQk()}if(2&e){const t=r.$implicit;n.xp6(5),n.Q6J("address",t),n.xp6(2),n.Oqu(t)}}function b(e,r){if(1&e&&(n.ynx(0),n.TgZ(1,"ion-row")(2,"ion-col",13),n._UZ(3,"ion-icon",14),n.qZA(),n.TgZ(4,"ion-col",15),n._uU(5),n.ALo(6,"translate"),n.qZA()(),n.TgZ(7,"ion-row")(8,"ion-text")(9,"p",16),n._uU(10),n.qZA()()(),n.BQk()),2&e){const t=n.oxw();n.xp6(5),n.Oqu(n.lcZ(6,2,"signed-transaction.transaction-unreadable")),n.xp6(5),n.Oqu(t.rawTxData)}}let Z=(()=>{class e{constructor(t,o,i,l,p,d){this.protocolService=t,this.serializerService=o,this.tokenService=i,this.secretsService=l,this.navigationService=p,this.contactsService=d,this.addressesNotOnContactBook=[],this.fallbackActivated=!1}ngOnChanges(){return(0,g.mG)(this,void 0,void 0,function*(){if(this.syncProtocolString)try{this.signedTxs=yield this.serializerService.deserialize(this.syncProtocolString)}catch(t){console.log("ERROR",t),this.fallbackActivated=!0,this.rawTxData=this.syncProtocolString}if(this.signedTxs){const t=yield this.protocolService.getProtocol(this.signedTxs[0].protocol,void 0,!1);try{this.airGapTxs=(yield Promise.all(this.signedTxs.map(o=>(0,g.mG)(this,void 0,void 0,function*(){const i=o.payload;return(yield this.checkIfSaplingTransaction(i,o.protocol))?(yield this.getSaplingProtocol()).getTransactionDetailsFromSigned(i,{knownViewingKeys:yield this.secretsService.getKnownViewingKeys()}):t.getTransactionDetailsFromSigned(i)})))).reduce((o,i)=>o.concat(i)),this.airGapTxs.length>1&&this.airGapTxs.every(o=>o.protocolIdentifier===this.airGapTxs[0].protocolIdentifier)&&(this.aggregatedInfo={numberOfTxs:this.airGapTxs.length,totalAmount:new P.Z((0,c.r9)(this.airGapTxs,"amount")),totalFees:new P.Z((0,c.r9)(this.airGapTxs,"fee"))});try{if(1!==this.airGapTxs.length)throw Error("TokenTransferDetails returned more than 1 transaction!");this.airGapTxs=[yield this.tokenService.getTokenTransferDetailsFromSigned(this.airGapTxs[0],this.signedTxs[0].payload)]}catch(o){console.error("unable to parse token transaction, using ethereum transaction details instead")}this.fallbackActivated=!1}catch(o){this.fallbackActivated=!0,this.rawTxData=this.signedTxs[0].payload.transaction}}this.checkAdressesNames()})}checkAdressesNames(){return(0,g.mG)(this,void 0,void 0,function*(){if(this.airGapTxs&&this.airGapTxs.length>0&&(yield this.contactsService.isBookEnabled())){this.addressesNotOnContactBook=[];for(let o=0;o<this.airGapTxs.length;o++){this.airGapTxs[o].extra={names:{}};const i=this.airGapTxs[o],l=i.to;for(let d=0;d<l.length;d++){const u=l[d];if(yield this.contactsService.isAddressInContacts(u)){const C=yield this.contactsService.getContactName(u);C&&(this.airGapTxs[o].extra.names[u]=C)}else this.addressesNotOnContactBook.push(u)}const p=i.from;for(let d=0;d<p.length;d++){const u=p[d];if((yield this.contactsService.isAddressInContacts(u))||this.addressesNotOnContactBook.includes(u)){const C=yield this.contactsService.getContactName(u);C&&(this.airGapTxs[o].extra.names[u]=C)}else this.addressesNotOnContactBook.push(u)}}}})}checkIfSaplingTransaction(t,o){return(0,g.mG)(this,void 0,void 0,function*(){if(o===S.MainProtocolSymbols.XTZ)try{return(yield(yield this.getSaplingProtocol()).getTransactionDetailsFromSigned(t)).map(d=>d.to).reduce((d,u)=>d.concat(u),[]).some(d=>d.startsWith("zet")||"shielded pool"===d.toLocaleLowerCase())}catch(i){return console.error(i),!1}return o===S.MainProtocolSymbols.XTZ_SHIELDED})}getSaplingProtocol(){return(0,g.mG)(this,void 0,void 0,function*(){return yield this.protocolService.getProtocol(S.MainProtocolSymbols.XTZ_SHIELDED)})}onClickAddContact(t){return(0,g.mG)(this,void 0,void 0,function*(){this.navigationService.routeWithState("/contact-book-contacts-detail",{isNew:!0,address:t,addType:w.R.SIGNING}).catch((0,_.a1)(_.qj.IONIC_NAVIGATION))})}onClickDontAddContact(t){return(0,g.mG)(this,void 0,void 0,function*(){yield this.contactsService.addSuggestion(t);const o=this.addressesNotOnContactBook.findIndex(i=>i==i);o>=0&&this.addressesNotOnContactBook.splice(o,1)})}onClickDisableContact(){return(0,g.mG)(this,void 0,void 0,function*(){yield this.contactsService.setBookEnable(!1),this.addressesNotOnContactBook=[]})}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(c.dJ),n.Y36(c.fb),n.Y36(M),n.Y36(D.R),n.Y36(y.f),n.Y36(w.P))},e.\u0275cmp=n.Xpm({type:e,selectors:[["airgap-signed-transaction"]],inputs:{signedTxs:"signedTxs",syncProtocolString:"syncProtocolString"},features:[n.TTD],decls:4,vars:4,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"ion-padding-bottom","ion-text-center"],["size","4",1,"content--align__center-center"],["size","4"],[3,"transaction"],[1,"ion-padding-horizontal",3,"transaction","hideNetwork"],[1,"suggestion-wrapper"],[1,"divider"],[1,"image",3,"address"],[1,"divider-buttons"],["color","tertiary",1,"button",3,"click"],["color","primary",1,"button",3,"click"],["size","2",1,"ion-margin-top"],["color","white","src","assets/icons/md-warning.svg",1,"warning-icon"],["size","10"],[1,"text--selectable","typography--mono","word-break__all"]],template:function(t,o){1&t&&(n.YNc(0,I,24,17,"ng-container",0),n.YNc(1,N,3,3,"ng-container",1),n.YNc(2,G,17,2,"ng-container",1),n.YNc(3,b,11,4,"ng-container",0)),2&t&&(n.Q6J("ngIf",o.airGapTxs&&o.airGapTxs.length>1),n.xp6(1),n.Q6J("ngForOf",o.airGapTxs),n.xp6(1),n.Q6J("ngForOf",o.addressesNotOnContactBook),n.xp6(1),n.Q6J("ngIf",o.fallbackActivated))},directives:[m.O5,a.Nd,a.wI,m.sg,k.p,c.j$,c.bY,a.YG,a.gu,a.yW],pipes:[m.Ov,c.Se,c.Ce,f.X$],styles:[".suggestion-wrapper[_ngcontent-%COMP%]{display:flex;flex-direction:column;border:1px solid var(--ion-color-primary);padding:12px;border-radius:12px}.suggestion-wrapper[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{margin-top:0;color:var(--ion-color-primary);margin-bottom:12px;font-weight:500}.suggestion-wrapper[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{color:#fff}.suggestion-wrapper[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]{display:flex;align-items:center;gap:12px;margin-bottom:12px}.suggestion-wrapper[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]   span[_ngcontent-%COMP%]{flex:1;line-break:anywhere;font-size:14px;font-weight:600}.suggestion-wrapper[_ngcontent-%COMP%]   .divider[_ngcontent-%COMP%]   .image[_ngcontent-%COMP%]{width:50px;height:50px}.suggestion-wrapper[_ngcontent-%COMP%]   .divider-buttons[_ngcontent-%COMP%]{display:flex;align-items:center;gap:4px}.suggestion-wrapper[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{flex:1;font-size:14px;--padding-bottom: 12px;--padding-top: 12px}"]}),e})();function U(e,r){if(1&e&&(n.TgZ(0,"pre",6),n._uU(1),n.ALo(2,"json"),n.qZA()),2&e){const t=n.oxw(2);n.xp6(1),n.Oqu(n.lcZ(2,1,t.messageSignResponse))}}function B(e,r){if(1&e){const t=n.EpF();n.ynx(0),n.TgZ(1,"ion-row",1)(2,"ion-col",2)(3,"ion-item",3)(4,"ion-label"),n._uU(5),n.ALo(6,"translate"),n.qZA(),n.TgZ(7,"ion-toggle",4),n.NdJ("ionChange",function(){return n.CHM(t),n.oxw().toggleDisplayRawData()}),n.qZA()(),n.YNc(8,U,3,3,"pre",5),n.qZA()(),n.BQk()}if(2&e){const t=n.oxw();n.xp6(5),n.Oqu(n.lcZ(6,3,"message-signing-response.text")),n.xp6(2),n.Q6J("checked",t.displayRawData),n.xp6(1),n.Q6J("ngIf",t.displayRawData)}}let Q=(()=>{class e{constructor(){this.displayRawData=!1}toggleDisplayRawData(){this.displayRawData=!this.displayRawData}}return e.\u0275fac=function(t){return new(t||e)},e.\u0275cmp=n.Xpm({type:e,selectors:[["airgap-message-sign-response"]],inputs:{messageSignResponse:"messageSignResponse"},decls:1,vars:1,consts:[[4,"ngIf"],[1,"rawdata--container"],[1,"ion-no-padding"],["lines","none",1,"ion-no-padding"],["slot","end",3,"checked","ionChange"],["class","ion-no-margin",4,"ngIf"],[1,"ion-no-margin"]],template:function(t,o){1&t&&n.YNc(0,B,9,5,"ng-container",0),2&t&&n.Q6J("ngIf",o.messageSignResponse)},directives:[m.O5,a.Nd,a.wI,a.Ie,a.Q$,a.ho,a.w],pipes:[f.X$,m.Ts],styles:[".ion-no-margin[_ngcontent-%COMP%]{color:#fff}"]}),e})();function J(e,r){if(1&e&&n._UZ(0,"airgap-iac-qr",10),2&e){const t=n.oxw();n.Q6J("level","L")("messageDefinitionObjects",t.interactionUrl)("size",300)}}function L(e,r){if(1&e&&n._UZ(0,"airgap-qr",11),2&e){const t=n.oxw();n.Q6J("level","L")("qrdata",t.signedTxs)("size",300)}}function F(e,r){if(1&e&&(n.ynx(0),n._UZ(1,"airgap-message-sign-response",12),n.BQk()),2&e){const t=n.oxw();n.xp6(1),n.Q6J("messageSignResponse",t.messageSignResponse)}}function q(e,r){if(1&e&&(n.ynx(0),n._UZ(1,"airgap-signed-transaction",13),n.BQk()),2&e){const t=n.oxw();n.xp6(1),n.Q6J("signedTxs",t.interactionUrl)}}const Y=[{path:"",component:(()=>{class e{constructor(t,o){this.navigationService=t,this.translateService=o,this.qrType=0,this.addressesNotOnContactBook=[],this.interactionUrl=this.navigationService.getState().interactionUrl,this.wallets=this.navigationService.getState().wallets,this.signedTxs=this.navigationService.getState().signedTxs,this.translationKey=this.navigationService.getState().translationKey,this.pageTitle=this.translateService.instant(`${this.translationKey}.title`),this.heading=this.translateService.instant(`${this.translationKey}.heading`),this.messageSignResponse=this.navigationService.getState().messageSignResponse}ionViewWillEnter(){var t;const o=this.interactionUrl;this.interactionUrl=null,this.interactionUrl=o,null===(t=this.transactionComponent)||void 0===t||t.checkAdressesNames()}done(){this.navigationService.routeToSecretsTab().catch((0,_.a1)(_.qj.IONIC_NAVIGATION))}}return e.\u0275fac=function(t){return new(t||e)(n.Y36(y.f),n.Y36(f.sK))},e.\u0275cmp=n.Xpm({type:e,selectors:[["airgap-transaction-signed"]],viewQuery:function(t,o){if(1&t&&n.Gf(Z,5),2&t){let i;n.iGM(i=n.CRH())&&(o.transactionComponent=i.first)}},decls:17,vars:9,consts:[[1,"ion-no-border"],["slot","start"],[1,"ion-padding"],[3,"innerHTML"],[1,"ion-justify-content-center","ion-padding-top"],[3,"level","messageDefinitionObjects","size",4,"ngIf"],[3,"level","qrdata","size",4,"ngIf"],[4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["color","primary","shape","round",3,"click"],[3,"level","messageDefinitionObjects","size"],[3,"level","qrdata","size"],[3,"messageSignResponse"],[3,"signedTxs"]],template:function(t,o){1&t&&(n.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),n._UZ(3,"ion-back-button"),n.qZA(),n.TgZ(4,"ion-title"),n._uU(5),n.qZA()()(),n.TgZ(6,"ion-content",2),n._UZ(7,"h3",3),n.TgZ(8,"ion-row",4),n.YNc(9,J,1,3,"airgap-iac-qr",5),n.YNc(10,L,1,3,"airgap-qr",6),n.qZA(),n.YNc(11,F,2,1,"ng-container",7),n.YNc(12,q,2,1,"ng-container",7),n.TgZ(13,"ion-fab",8)(14,"ion-button",9),n.NdJ("click",function(){return o.done()}),n._uU(15),n.ALo(16,"translate"),n.qZA()()()),2&t&&(n.xp6(5),n.Oqu(o.pageTitle),n.xp6(2),n.Q6J("innerHTML",o.heading,n.oJD),n.xp6(2),n.Q6J("ngIf",o.interactionUrl&&0===o.qrType),n.xp6(1),n.Q6J("ngIf",o.signedTxs&&1===o.qrType),n.xp6(1),n.Q6J("ngIf",o.messageSignResponse),n.xp6(1),n.Q6J("ngIf",o.signedTxs),n.xp6(3),n.Oqu(n.lcZ(16,7,"transaction-signed.done_label")))},directives:[a.Gu,a.sr,a.Sm,a.oU,a.cs,a.wd,a.W2,a.Nd,m.O5,c.HB,c.Sx,Q,Z,a.IJ,a.YG],pipes:[f.X$],styles:["airgap-qr[_ngcontent-%COMP%]{width:340px;height:340px}ion-content[_ngcontent-%COMP%]{--padding-bottom: var(--ion-padding, 64px)}"]}),e})()}];let z=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=n.oAB({type:e}),e.\u0275inj=n.cJS({imports:[[m.ez,A.K,h.u5,a.Pc,v.Bz.forChild(Y),f.aw,c.aD]]}),e})()},51628:(O,x,s)=>{s.d(x,{D:()=>m});var c=s(9288);let m=(()=>{class h{}return h.\u0275fac=function(a){return new(a||h)},h.\u0275mod=c.oAB({type:h}),h.\u0275inj=c.cJS({imports:[[]]}),h})()}}]);