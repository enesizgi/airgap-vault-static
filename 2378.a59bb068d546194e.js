"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[2378],{42723:(A,P,i)=>{i.d(P,{K:()=>e});var l=i(20976),T=i(12714),o=i(84653),S=i(3323),v=i(34388),_=i(9527),d=i(51628),M=i(9288);let e=(()=>{class h{}return h.\u0275fac=function(O){return new(O||h)},h.\u0275mod=M.oAB({type:h}),h.\u0275inj=M.cJS({imports:[[S.Pc,d.D,T.ez,o.u5,v.aw,_.N,l.aD]]}),h})()},58286:(A,P,i)=>{i.r(P),i.d(P,{TabSecretsPageModule:()=>j});var l=i(12714),T=i(84653),o=i(3323),S=i(23345),v=i(65949),_=i(56810),d=i(55956),M=i(27204),e=i(9288),h=i(34388);let C=(()=>{class n{constructor(t,s){this.navigationService=t,this.navParams=s}goToNewSecret(){this.onClickNewSecret&&this.onClickNewSecret(),this.navigationService.route("/secret-setup").catch((0,d.a1)(d.qj.IONIC_NAVIGATION))}syncWalletsHandler(){this.onClickSyncWallets&&this.onClickSyncWallets()}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(M.f),e.Y36(o.X1))},n.\u0275cmp=e.Xpm({type:n,selectors:[["airgap-tab-secret-popover"]],decls:13,vars:9,consts:[["lines","none",1,"ion-no-padding","ion-no-margin"],["button","","detail","false",3,"click"],["slot","start","name","add"],["slot","start","name","sync-outline"]],template:function(t,s){1&t&&(e.TgZ(0,"ion-list",0)(1,"ion-list-header")(2,"ion-label"),e._uU(3),e.ALo(4,"translate"),e.qZA()(),e.TgZ(5,"ion-item",1),e.NdJ("click",function(){return s.goToNewSecret()}),e._UZ(6,"ion-icon",2),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"ion-item",1),e.NdJ("click",function(){return s.syncWalletsHandler()}),e._UZ(10,"ion-icon",3),e._uU(11),e.ALo(12,"translate"),e.qZA()()),2&t&&(e.xp6(3),e.Oqu(e.lcZ(4,3,"tab-secrets.tab-secret-popover.title")),e.xp6(4),e.hij(" ",e.lcZ(8,5,"tab-secrets.tab-secret-popover.add-secret_label")," "),e.xp6(4),e.hij(" ",e.lcZ(12,7,"tab-secrets.tab-secret-popover.sync-all_label")," "))},directives:[o.q_,o.yh,o.Q$,o.Ie,o.gu],pipes:[h.X$],styles:[""]}),n})();var O=i(45499),W=i(88061),r=i(22951),u=(i(52971),i(16183)),g=i(63181),f=i(20976);function y(n,c){if(1&n&&e._UZ(0,"img",15),2&n){const t=e.oxw(2);e.Q6J("src",t.lifehashData,e.LSH)}}function D(n,c){if(1&n&&(e.TgZ(0,"ion-row")(1,"ion-col",12),e.YNc(2,y,1,1,"img",13),e.qZA(),e.TgZ(3,"ion-col")(4,"ion-card-subtitle",14),e._uU(5),e.qZA(),e.TgZ(6,"ion-card-title",14),e._uU(7),e.qZA()()()),2&n){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.lifehashData),e.xp6(3),e.Oqu(t.secret.fingerprint),e.xp6(2),e.hij(" ",t.secret.label," ")}}function I(n,c){if(1&n&&(e.TgZ(0,"ion-card-title",14),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.xp6(1),e.hij(" ",t.secret.label," ")}}function E(n,c){if(1&n&&(e.TgZ(0,"span",16),e._UZ(1,"airgap-currency-symbol",17),e.qZA()),2&n){const t=c.$implicit;e.xp6(1),e.Q6J("symbol",t)}}function Z(n,c){if(1&n&&(e.TgZ(0,"ion-button",18),e._uU(1),e.qZA()),2&n){const t=e.oxw();e.Q6J("color","tertiary"),e.xp6(1),e.hij("+",t.hasMoreWallets,"")}}let x=(()=>{class n{constructor(t,s,p,a){this.secretsService=t,this.navigationService=s,this.lifehashService=p,this.storageService=a,this.hasMoreWallets=0,this.lifehashData="",this.isAdvancedMode$=this.storageService.subscribe(u.NT.ADVANCED_MODE_TYPE).pipe((0,g.U)(b=>b===u.$r.ADVANCED))}ngOnInit(){return(0,v.mG)(this,void 0,void 0,function*(){this.secretsService.getActiveSecretObservable().subscribe(t=>{t&&t.wallets&&this.getWalletsFromSecret()}),this.getWalletsFromSecret(),this.lifehashData=yield this.lifehashService.generateLifehash(this.secret.fingerprint)})}getWalletsFromSecret(){return(0,v.mG)(this,void 0,void 0,function*(){const t=this.secret.wallets.filter(a=>a.status===W.AirGapWalletStatus.ACTIVE),p=(yield Promise.all(t.map(a=>(0,v.mG)(this,void 0,void 0,function*(){return[yield a.protocol.getName(),a]})))).sort((a,b)=>a[0].localeCompare(b[0])).map(([a,b])=>b);this.activeWallets=yield Promise.all(p.map(a=>(0,v.mG)(this,void 0,void 0,function*(){return a.protocol.getSymbol()}))),this.activeWallets.length>10?(this.hasMoreWallets=this.activeWallets.length-10,this.activeWallets=this.activeWallets.slice(0,10)):this.hasMoreWallets=0})}goToEditSecret(t){t.stopPropagation(),this.navigationService.routeWithState("/secret-edit",{secret:this.secret}).catch((0,d.a1)(d.qj.IONIC_NAVIGATION))}goToAccountsList(){this.navigationService.routeWithState("/accounts-list",{secret:this.secret}).catch((0,d.a1)(d.qj.IONIC_NAVIGATION))}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(_.R),e.Y36(M.f),e.Y36(r.S),e.Y36(u.Cu))},n.\u0275cmp=e.Xpm({type:n,selectors:[["airgap-secret-item"]],inputs:{secret:"secret"},decls:16,vars:9,consts:[[1,"no-padding","background--color__gradient",3,"click"],[4,"ngIf"],["class","secret--label",4,"ngIf"],[1,"ion-padding-start",2,"margin-bottom","12%"],["class","airgap-currency-symbol-secret mtzero",4,"ngFor","ngForOf"],["shape","round","class","mtzero",3,"color",4,"ngIf"],["vertical","bottom","horizontal","","slot","fixed"],["color","tertiary","name","shield-checkmark"],["color","tertiary","name","extension-puzzle"],["vertical","bottom","horizontal","end","slot","fixed"],["shape","round",3,"color","click"],["name","settings-outline"],["size","3"],["class","lifehash",3,"src",4,"ngIf"],[1,"secret--label"],[1,"lifehash",3,"src"],[1,"airgap-currency-symbol-secret","mtzero"],[3,"symbol"],["shape","round",1,"mtzero",3,"color"]],template:function(t,s){1&t&&(e.TgZ(0,"ion-card",0),e.NdJ("click",function(){return s.goToAccountsList()}),e.TgZ(1,"ion-card-header"),e.YNc(2,D,8,3,"ion-row",1),e.ALo(3,"async"),e.YNc(4,I,2,1,"ion-card-title",2),e.ALo(5,"async"),e.qZA(),e.TgZ(6,"ion-card-content")(7,"ion-row",3),e.YNc(8,E,2,1,"span",4),e.YNc(9,Z,2,2,"ion-button",5),e.qZA(),e.TgZ(10,"ion-fab",6),e._UZ(11,"ion-icon",7)(12,"ion-icon",8),e.qZA(),e.TgZ(13,"ion-fab",9)(14,"ion-button",10),e.NdJ("click",function(a){return s.goToEditSecret(a)}),e._UZ(15,"ion-icon",11),e.qZA()()()()),2&t&&(e.xp6(2),e.Q6J("ngIf",e.lcZ(3,5,s.isAdvancedMode$)),e.xp6(2),e.Q6J("ngIf",!e.lcZ(5,7,s.isAdvancedMode$)),e.xp6(4),e.Q6J("ngForOf",s.activeWallets),e.xp6(1),e.Q6J("ngIf",s.hasMoreWallets>0),e.xp6(5),e.Q6J("color","primary"))},directives:[o.PM,o.Zi,l.O5,o.Nd,o.wI,o.tO,o.Dq,o.FN,l.sg,f.zZ,o.YG,o.IJ,o.gu],pipes:[l.Ov],styles:["ion-icon[_ngcontent-%COMP%]{font-size:16px}.secret--label[_ngcontent-%COMP%]{font-weight:500;color:#fff}.mtzero[_ngcontent-%COMP%]{margin-top:0}ion-button[_ngcontent-%COMP%]{width:45px;height:45px;text-align:center;--padding-end: 0;--padding-start: 0}.airgap-currency-symbol-secret[_ngcontent-%COMP%]{margin-left:-10px}.background--color__gradient[_ngcontent-%COMP%]{background:linear-gradient(#311b58,#311b58)}ion-fab[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:20px;margin-right:7px}ion-fab[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:30px;margin-right:0}"]}),n})(),N=(()=>{class n{transform(t,s){if(null===t||0===(null==t?void 0:t.length))return[];const p=null==s?void 0:s.label;return p?t.filter(a=>a.label.toLowerCase().includes(p)):t}}return n.\u0275fac=function(t){return new(t||n)},n.\u0275pipe=e.Yjl({name:"secretFilter",type:n,pure:!0}),n})();function L(n,c){if(1&n&&(e.ynx(0),e._UZ(1,"airgap-secret-item",8),e.BQk()),2&n){const t=c.$implicit;e.xp6(1),e.Q6J("secret",t)}}const U=function(n){return{label:n}};function F(n,c){if(1&n&&(e.ynx(0),e.YNc(1,L,2,1,"ng-container",7),e.ALo(2,"secretFilter"),e.ALo(3,"async"),e.BQk()),2&n){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",e.xi3(2,1,e.lcZ(3,4,t.secrets),e.VKq(6,U,t.secretFilter)))}}function B(n,c){if(1&n&&(e.ynx(0),e._UZ(1,"airgap-secret-item",8),e.BQk()),2&n){const t=c.$implicit;e.xp6(1),e.Q6J("secret",t)}}function K(n,c){if(1&n&&(e.YNc(0,B,2,1,"ng-container",7),e.ALo(1,"async")),2&n){const t=e.oxw();e.Q6J("ngForOf",e.lcZ(1,1,t.secrets))}}const G=[{path:"",component:(()=>{class n{constructor(t,s,p,a,b){this.popoverCtrl=t,this.modalController=s,this.navigationService=p,this.secretsService=a,this.modeService=b,this.secrets=this.secretsService.getSecretsObservable()}ngOnInit(){return(0,v.mG)(this,void 0,void 0,function*(){this.secrets.subscribe(t=>(0,v.mG)(this,void 0,void 0,function*(){0===t.length&&this.navigationService.route("/secret-setup/initial").catch((0,d.a1)(d.qj.IONIC_NAVIGATION))}))})}filterItems(t){const p=t.target.value;this.secretFilter=function s(a){return a&&"string"==typeof a&&""!==a}(p)?p.trim().toLowerCase():void 0}presentPopover(t){return(0,v.mG)(this,void 0,void 0,function*(){const s=yield this.popoverCtrl.create({component:C,componentProps:{onClickNewSecret:()=>{s.dismiss().catch((0,d.a1)(d.qj.IONIC_MODAL))},onClickSyncWallets:()=>{this.syncWallets(),s.dismiss().catch((0,d.a1)(d.qj.IONIC_MODAL))}},event:t,translucent:!0});s.present().catch((0,d.a1)(d.qj.IONIC_MODAL))})}syncWallets(){return(0,v.mG)(this,void 0,void 0,function*(){yield(yield this.modeService.strategy()).syncAll()})}}return n.\u0275fac=function(t){return new(t||n)(e.Y36(o.Dh),e.Y36(o.IN),e.Y36(M.f),e.Y36(_.R),e.Y36(O.d))},n.\u0275cmp=e.Xpm({type:n,selectors:[["airgap-tab-secrets"]],decls:15,vars:8,consts:[[1,"ion-no-border"],["color","secondary"],["slot","primary",3,"click"],["slot","icon-only","name","ellipsis-vertical"],[3,"placeholder","ionInput"],[4,"ngIf","ngIfElse"],["unfiltered",""],[4,"ngFor","ngForOf"],[3,"secret"]],template:function(t,s){if(1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar",1)(2,"ion-title"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-buttons",2),e.NdJ("click",function(a){return s.presentPopover(a)}),e.TgZ(6,"ion-button"),e._UZ(7,"ion-icon",3),e.qZA()()(),e.TgZ(8,"ion-toolbar",1)(9,"ion-searchbar",4),e.NdJ("ionInput",function(a){return s.filterItems(a)}),e.ALo(10,"translate"),e.qZA()()(),e.TgZ(11,"ion-content"),e.YNc(12,F,4,8,"ng-container",5),e.YNc(13,K,2,3,"ng-template",null,6,e.W1O),e.qZA()),2&t){const p=e.MAs(14);e.xp6(3),e.Oqu(e.lcZ(4,4,"tab-secrets.title")),e.xp6(6),e.s9C("placeholder",e.lcZ(10,6,"tab-secrets.search_placeholder")),e.xp6(3),e.Q6J("ngIf",s.secretFilter)("ngIfElse",p)}},directives:[o.Gu,o.sr,o.wd,o.Sm,o.YG,o.gu,o.VI,o.j9,o.W2,l.O5,l.sg,x],pipes:[h.X$,N,l.Ov],styles:["page-tab-secrets[_ngcontent-%COMP%]   hexagon-icon[_ngcontent-%COMP%]{height:56px;width:56px;float:left}page-tab-secrets[_ngcontent-%COMP%]   .secret--label[_ngcontent-%COMP%]{font-family:Courier New,Courier,Lucida Sans Typewriter,Lucida Typewriter,monospace;font-weight:800}"]}),n})()}];let J=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[S.Bz.forChild(G)],S.Bz]}),n})();var R=i(42723),Y=i(51628);let j=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=e.oAB({type:n}),n.\u0275inj=e.cJS({imports:[[l.ez,R.K,T.u5,o.Pc,J,h.aw,Y.D]]}),n})()},51628:(A,P,i)=>{i.d(P,{D:()=>T});var l=i(9288);let T=(()=>{class o{}return o.\u0275fac=function(v){return new(v||o)},o.\u0275mod=l.oAB({type:o}),o.\u0275inj=l.cJS({imports:[[]]}),o})()},13187:(A,P,i)=>{i.d(P,{H:()=>C});var l=i(65949),T=i(88061),o=i(90544),S=i(47898),v=i(52971),_=i(2853),d=i(55956),M=i(27204),e=i(56810),h=i(9288);let C=(()=>{class O{constructor(r,m){this.secretsService=r,this.navigationService=m}runSecretsMigration(r){return(0,l.mG)(this,void 0,void 0,function*(){return new Promise((m,u)=>{r.every(_.e)?m():this.navigateToMigrationPage({secrets:r}).then(m).catch(u)})})}runWalletsMigration(r){return(0,l.mG)(this,void 0,void 0,function*(){return new Promise((m,u)=>{r.every(_.l)?m():this.navigateToMigrationPage({wallets:r}).then(m).catch(u)})})}navigateToMigrationPage(r){return(0,l.mG)(this,void 0,void 0,function*(){return new Promise((m,u)=>{this.navigationService.routeWithState("/migration",Object.assign(Object.assign({},r),{onSuccess:m,onError:u})).catch(g=>{(0,d.a1)(d.qj.IONIC_NAVIGATION)(g),u(g)})})})}filterMigratedSecrets(r){return r.every(_.e)?[r,!0]:[r.filter(_.e),!1]}filterMigratedWallets(r){return r.every(_.l)?[r,!0]:[r.filter(_.l),!1]}deepFilterMigratedSecretsAndWallets(r){return(0,l.mG)(this,void 0,void 0,function*(){return r.every(_.e)?[r,!0]:[(yield Promise.all(r.map(u=>(0,l.mG)(this,void 0,void 0,function*(){if(!u.fingerprint)return;const[g]=this.filterMigratedWallets(u.wallets);if(0===g.length)return;const f=v.r.init(u);return f.wallets=g,f})))).filter(u=>void 0!==u),!1]})}migrateSecret(r,m={}){return(0,l.mG)(this,void 0,void 0,function*(){const g=Object.assign(Object.assign({},{persist:!1}),m);if(void 0===r.fingerprint){let f=g.mnemonic;if(void 0===f){const E=yield this.secretsService.retrieveEntropyForSecret(r);f=(0,S.entropyToMnemonic)(E)}const y=yield(0,S.mnemonicToSeed)(f),I=(0,o.fromSeed)(y).fingerprint.toString("hex");r.fingerprint=I}g.persist&&(yield this.secretsService.addOrUpdateSecret(r,{setActive:!1}))})}migrateWallet(r,m){return(0,l.mG)(this,void 0,void 0,function*(){const g=Object.assign(Object.assign({},{bip39Passphrase:"",persist:!1}),m);if(r.masterFingerprint&&!g.persist)return;let y,f=g.mnemonic;if((void 0===f||g.persist)&&(y=this.secretsService.findByPublicKey(r.publicKey)),void 0===f&&void 0!==y){const x=yield this.secretsService.retrieveEntropyForSecret(y);f=(0,S.entropyToMnemonic)(x)}else if(void 0===f)return;if((yield r.protocol.getPublicKeyFromMnemonic(f,r.derivationPath,g.bip39Passphrase))!==r.publicKey)throw new Error("Invalid BIP-39 Passphrase");const I=yield(0,S.mnemonicToSeed)(f,g.bip39Passphrase),Z=(0,o.fromSeed)(I).fingerprint.toString("hex");r.masterFingerprint=Z,r.status=T.AirGapWalletStatus.ACTIVE,g.persist&&void 0!==y&&(yield this.migrateSecret(y,{mnemonic:g.mnemonic,persist:g.persist}))})}}return O.\u0275fac=function(r){return new(r||O)(h.LFG(e.R),h.LFG(M.f))},O.\u0275prov=h.Yz7({token:O,factory:O.\u0275fac,providedIn:"root"}),O})()},2853:(A,P,i)=>{function l(o){return o.fingerprint&&o.wallets.every(T)}function T(o){return!!o.masterFingerprint}i.d(P,{e:()=>l,l:()=>T})}}]);