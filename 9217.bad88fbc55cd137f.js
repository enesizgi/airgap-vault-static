"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9217],{42723:(Q,x,c)=>{c.d(x,{K:()=>L});var D=c(20976),C=c(12714),b=c(84653),p=c(3323),y=c(34388),r=c(9527),E=c(51628),l=c(9288);let L=(()=>{class g{}return g.\u0275fac=function(m){return new(m||g)},g.\u0275mod=l.oAB({type:g}),g.\u0275inj=l.cJS({imports:[[p.Pc,E.D,C.ez,b.u5,y.aw,r.N,D.aD]]}),g})()},99217:(Q,x,c)=>{c.r(x),c.d(x,{DeserializedDetailPageModule:()=>vt});var D=c(12714),C=c(84653),b=c(23345),p=c(3323),y=c(32256),r=c(25535),E=c(34388),l=c(20976),L=c(42723),g=c(65949),M=c(88061),m=c(22956),Se=c(44732),W=c(47898),H=c(30243),B=c(48060),N=c(67926),_=c(24586),q=c(39141),J=c(24964),Y=c(68019),k=c(29508),w=c(98691),V=c(27204),Pe=c(56810);const f="Deserialized Detail",X=(0,r.PH)(`[${f}] View Initialization`),ee=(0,r.PH)(`[${f}] Navigation Data Loading`),te=(0,r.PH)(`[${f}] Navigation Data Loaded`,(0,r.Ky)()),se=(0,r.PH)(`[${f}] Navigation Data Loading Error`,(0,r.Ky)()),De=(0,r.PH)(`[${f}] Invalid Navigation Data`),ne=(0,r.PH)(`[${f}] Approved`),ie=(0,r.PH)(`[${f}] Continue Approved`,(0,r.Ky)()),ae=(0,r.PH)(`[${f}] Alert Dismissed`,(0,r.Ky)()),oe=(0,r.PH)(`[${f}] Modal Dismissed`,(0,r.Ky)()),re=(0,r.PH)(`[${f}] BIP-39 Passphrase Provided`,(0,r.Ky)()),le=(0,r.PH)(`[${f}] Signing Protocol Provided`,(0,r.Ky)()),ce=(0,r.PH)(`[${f}] Running Blocking Task`,(0,r.Ky)()),R=(0,r.PH)(`[${f}] Transactions Signed`,(0,r.Ky)()),$=(0,r.PH)(`[${f}] Messages Signed`,(0,r.Ky)()),be=(0,r.PH)(`[${f}] Loader Dismissed`,(0,r.Ky)()),z=(0,r.PH)(`[${f}] Secret Not Found`),de=(0,r.PH)(`[${f}] Protocol Not Found`),Z=(0,r.PH)(`[${f}] Invalid BIP-39 Passphrase`),U=(0,r.PH)(`[${f}] Unknown Error`,(0,r.Ky)());var P=(()=>{return(s=P||(P={}))[s.SIGN_TRANSACTION=0]="SIGN_TRANSACTION",s[s.SIGN_MESSAGE=1]="SIGN_MESSAGE",P;var s})();const xe=(0,r.Lq)({mode:void 0,title:"",button:void 0,loader:void 0,alert:void 0,modal:void 0,transactions:{value:void 0,status:l.Tq.IDLE},messages:{value:void 0,status:l.Tq.IDLE},raw:{value:void 0,status:l.Tq.IDLE},bip39PassphraseTries:0},(0,r.on)(ee,s=>Object.assign(Object.assign({},s),{loader:void 0,alert:void 0,modal:void 0,transactions:{value:s.transactions.value,status:l.Tq.LOADING},messages:{value:s.messages.value,status:l.Tq.LOADING},raw:{value:s.raw.value,status:l.Tq.LOADING},bip39PassphraseTries:0})),(0,r.on)(te,(s,{mode:a,title:t,button:n,transactions:i,messages:o,raw:d})=>Object.assign(Object.assign({},s),{mode:a,title:t,button:n,loader:void 0,alert:void 0,modal:void 0,transactions:{value:i,status:l.Tq.SUCCESS},messages:{value:o,status:l.Tq.SUCCESS},raw:{value:d,status:l.Tq.SUCCESS},bip39PassphraseTries:0})),(0,r.on)(se,(s,{mode:a,title:t,button:n,raw:i})=>Object.assign(Object.assign({},s),{mode:a,title:t,button:n,loader:void 0,alert:void 0,modal:void 0,transactions:{value:void 0,status:l.Tq.ERROR},messages:{value:void 0,status:l.Tq.ERROR},raw:{value:i,status:l.Tq.SUCCESS}})),(0,r.on)(R,(s,{transactions:a})=>{var t;return Object.assign(Object.assign({},s),{loader:void 0,alert:void 0,transactions:{value:(null!==(t=s.transactions.value)&&void 0!==t?t:[]).concat(a),status:s.transactions.status},bip39PassphraseTries:0})}),(0,r.on)($,(s,{messages:a})=>{var t;return Object.assign(Object.assign({},s),{loader:void 0,alert:void 0,modal:void 0,messages:{value:(null!==(t=s.messages.value)&&void 0!==t?t:[]).concat(a),status:s.transactions.status},bip39PassphraseTries:0})}),(0,r.on)(be,(s,{id:a})=>Object.assign(Object.assign({},s),{loader:void 0!==s.loader?{id:s.loader.id,value:s.loader.value,status:a===s.loader.id?l.vQ.HANDLED:s.loader.status,userInput:a===s.loader.id?{}:s.loader.userInput}:void 0})),(0,r.on)(ae,(s,{id:a})=>Object.assign(Object.assign({},s),{alert:void 0!==s.alert?{id:s.alert.id,value:s.alert.value,status:a===s.alert.id?l.vQ.HANDLED:s.alert.status}:void 0,modal:void 0})),(0,r.on)(oe,(s,{id:a})=>Object.assign(Object.assign({},s),{alert:void 0,modal:void 0!==s.modal?{id:s.modal.id,value:s.modal.value,status:a===s.modal.id?l.vQ.HANDLED:s.modal.status}:void 0})),(0,r.on)(Z,s=>Object.assign(Object.assign({},s),s.bip39PassphraseTries<1?{loader:void 0,alert:{id:(0,l.qs)(),value:{type:"bip39Passphrase"},status:l.vQ.PENDING},modal:void 0,bip39PassphraseTries:s.bip39PassphraseTries+1}:{loader:void 0,alert:{id:(0,l.qs)(),value:{type:"bip39PassphraseError"},status:l.vQ.PENDING},modal:void 0,bip39PassphraseTries:0})),(0,r.on)(z,s=>Object.assign(Object.assign({},s),{alert:{id:(0,l.qs)(),value:{type:"secretNotFound"},status:l.vQ.PENDING},modal:void 0})),(0,r.on)(de,s=>Object.assign(Object.assign({},s),{loader:void 0,alert:void 0,modal:{id:(0,l.qs)(),value:"selectSigningAccount",status:l.vQ.PENDING}})),(0,r.on)(ce,(s,{task:a,userInput:t})=>Object.assign(Object.assign({},s),{loader:{id:(0,l.qs)(),value:a,status:l.vQ.PENDING,userInput:t}})),(0,r.on)(U,(s,{message:a})=>Object.assign(Object.assign({},s),{loader:void 0,alert:{id:(0,l.qs)(),value:{type:"unknownError",message:(null==a?void 0:a.length)>0?a:void 0},status:l.vQ.PENDING},modal:void 0}))),I=(0,r.ZF)("deserializedDetail"),G=(0,r.P1)(I,s=>s.mode),Ee=(0,r.P1)(I,s=>s.title),Me=(0,r.P1)(I,s=>s.button),Ce=(0,r.P1)(I,s=>s.loader),Oe=(0,r.P1)(I,s=>s.alert),Ne=(0,r.P1)(I,s=>s.modal),j=(0,r.P1)(I,s=>s.transactions),ue=s=>a=>{var t;return{value:null===(t=a.value)||void 0===t?void 0:t.filter(n=>n.type===s),status:a.status}},ge=(0,r.P1)(j,ue("unsigned")),he=(0,r.P1)(j,ue("signed")),F=(s,a)=>{var t;const n=null===(t=s.value)||void 0===t?void 0:t.filter(i=>void 0===a||i.type===a).map(i=>i.details);return{value:void 0!==n?(0,l.$t)(n):void 0,status:s.status}},Ge=(0,r.P1)(G,j,(s,a)=>s===P.SIGN_TRANSACTION?F(a,"unsigned"):{value:void 0,status:a.status}),pe=((0,r.P1)(ge,F),(0,r.P1)(he,F),(0,r.P1)(I,s=>s.messages)),ve=(0,r.P1)(pe,("unsigned",a=>{var t;return{value:null===(t=a.value)||void 0===t?void 0:t.filter(n=>"unsigned"===n.type),status:a.status}})),fe=(s,a)=>{var t;return{value:null===(t=s.value)||void 0===t?void 0:t.filter(i=>void 0===a||i.type===a).map(i=>({data:i.data.message,blake2bHash:"unsigned"===i.type?i.blake2bHash:void 0})),status:s.status}},_e=(0,r.P1)(G,pe,(s,a)=>s===P.SIGN_MESSAGE?fe(a,"unsigned"):{value:void 0,status:a.status}),we=((0,r.P1)(ve,fe),(0,r.P1)(I,s=>s.raw)),me=(0,r.P1)(G,ge,he,ve,(s,a,t,n)=>{switch(s){case P.SIGN_TRANSACTION:return{mode:s,data:a.value};case P.SIGN_MESSAGE:return{mode:s,data:n.value};default:(0,l.vE)("selectFinalPayload",s)}});var e=c(9288);let Re=(()=>{class s{constructor(t,n,i,o,d,u,h,T,A){this.actions$=t,this.store=n,this.navigationService=i,this.translateService=o,this.protocolService=d,this.secretsService=u,this.keyPairService=h,this.transactionService=T,this.interactionService=A,this.navigationData$=(0,y.GW)(()=>this.actions$.pipe((0,y.l4)(X),(0,_.w)(()=>(0,H.z)((0,B.of)(ee()),(0,N.D)(this.loadNavigationData()).pipe((0,q.P)()))))),this.approved$=(0,y.GW)(()=>this.actions$.pipe((0,y.l4)(ne,re,le),(0,J.b)(v=>(0,N.D)([v]).pipe((0,Y.M)(this.store.select(me)))),(0,_.w)(([v,O])=>{const ft={bip39Passphrase:"passphrase"in v?v.passphrase:void 0,protocol:"protocol"in v?v.protocol:void 0};return(0,H.z)((0,B.of)(ce({task:this.identifyPayloadTask(O),userInput:ft})))}))),this.continueApproved$=(0,y.GW)(()=>this.actions$.pipe((0,y.l4)(ie),(0,J.b)(v=>(0,N.D)([v]).pipe((0,Y.M)(this.store.select(me)))),(0,_.w)(([v,O])=>(0,N.D)(this.handlePayload(O,v.userInput)).pipe((0,q.P)())))),this.navigateWithSignedTransactions$=(0,y.GW)(()=>this.actions$.pipe((0,y.l4)(R),(0,k.b)(v=>this.navigateWithSignedTransactions(v.transactions))),{dispatch:!1}),this.navigateWithSignedMessages$=(0,y.GW)(()=>this.actions$.pipe((0,y.l4)($),(0,k.b)(v=>this.navigateWithSignedMessages(v.messages))),{dispatch:!1})}loadNavigationData(){return(0,g.mG)(this,void 0,void 0,function*(){const t=this.navigationService.getState(),[,n]=this.getPageTypes(t.type),i=this.getMode(t.type);if(void 0===n||void 0===i||void 0===t.transactionInfos)return De();{const o=this.translateService.instant(`deserialized-detail.${n}.title`),d=this.translateService.instant(`deserialized-detail.${n}.button_label`),u=this.signTransactionInfoToRaw(t.transactionInfos);try{const[h,T]=yield Promise.all([this.signTransactionInfoToUnsignedTransactions(t.transactionInfos,t.iacContext),this.signTransactionInfoToUnsignedMessages(t.transactionInfos,t.iacContext)]);return te({mode:i,title:o,button:d,transactions:h,messages:T,raw:u})}catch(h){return console.warn(h),se({mode:i,title:o,button:d,raw:u})}}})}getPageTypes(t){let n,i;return t===m.IACMessageType.TransactionSignRequest||t===m.IACMessageType.MessageSignRequest?n="request":(t===m.IACMessageType.TransactionSignResponse||t===m.IACMessageType.MessageSignResponse)&&(n="response"),t===m.IACMessageType.TransactionSignRequest||t===m.IACMessageType.TransactionSignResponse?i="transaction":(t===m.IACMessageType.MessageSignRequest||t===m.IACMessageType.MessageSignResponse)&&(i="message"),[n,i]}getMode(t){switch(t){case m.IACMessageType.TransactionSignRequest:return P.SIGN_TRANSACTION;case m.IACMessageType.MessageSignRequest:return P.SIGN_MESSAGE;default:return}}signTransactionInfoToRaw(t){const n=t.map(o=>{switch(o.signTransactionRequest.type){case m.IACMessageType.TransactionSignRequest:case m.IACMessageType.TransactionSignResponse:return o.signTransactionRequest.payload.transaction;default:return o.signTransactionRequest.payload}});return JSON.stringify(n.length>1?n:n[0])}signTransactionInfoToUnsignedTransactions(t,n){return(0,g.mG)(this,void 0,void 0,function*(){return Promise.all(t.map(i=>[i.wallet,i.signTransactionRequest]).filter(([i,o])=>o.type===m.IACMessageType.TransactionSignRequest).map(([i,o])=>(0,g.mG)(this,void 0,void 0,function*(){let d;return d=(yield this.checkIfSaplingTransaction(o.payload,o.protocol))?yield this.transactionService.getDetailsFromIACMessages([o],{overrideProtocol:yield this.getSaplingProtocol(),data:{knownViewingKeys:yield this.secretsService.getKnownViewingKeys()}}):yield this.transactionService.getDetailsFromIACMessages([o]),{type:"unsigned",id:o.id,details:d,data:o.payload,iacContext:n,wallet:i,originalProtocolIdentifier:o.protocol!==(yield i.protocol.getSymbol())?o.protocol:void 0}})))})}signTransactionInfoToUnsignedMessages(t,n){return(0,g.mG)(this,void 0,void 0,function*(){return Promise.all(t.map(i=>[i.wallet,i.signTransactionRequest]).filter(([i,o])=>o.type===m.IACMessageType.MessageSignRequest).map(([i,o])=>(0,g.mG)(this,void 0,void 0,function*(){const d=o.payload;let u;return o.protocol===M.MainProtocolSymbols.XTZ&&(u=yield(new Se.TezosCryptoClient).blake2bLedgerHash(d.message)),{type:"unsigned",id:o.id,protocol:o.protocol,data:d,iacContext:n,blake2bHash:u,wallet:i,originalProtocolIdentifier:o.protocol!==(yield i.protocol.getSymbol())?o.protocol:void 0}})))})}identifyPayloadTask(t){switch(t.mode){case P.SIGN_TRANSACTION:return"signTransaction";case P.SIGN_MESSAGE:return"signMessage";default:return"generic"}}handlePayload(t,n){return(0,g.mG)(this,void 0,void 0,function*(){switch(t.mode){case P.SIGN_TRANSACTION:return this.signTransactions(t.data,n.bip39Passphrase);case P.SIGN_MESSAGE:return this.signMessages(t.data,n.bip39Passphrase,n.protocol);default:(0,l.vE)("handlePayload",t)}})}signTransactions(t,n=""){var i,o;return(0,g.mG)(this,void 0,void 0,function*(){try{const d=yield Promise.all(t.map(u=>(0,g.mG)(this,void 0,void 0,function*(){const h=yield this.signTransaction(u.wallet,u.data,u.iacContext,n);return{type:"signed",id:u.id,details:u.details,data:{accountIdentifier:u.wallet.publicKey,transaction:h,callbackURL:u.data.callbackURL},iacContext:u.iacContext,wallet:u.wallet,originalProtocolIdentifier:u.originalProtocolIdentifier}})));return R({transactions:d})}catch(d){return console.warn(d),(null===(i=d.message)||void 0===i?void 0:i.toLowerCase().startsWith("secret not found"))?z():(null===(o=d.message)||void 0===o?void 0:o.toLowerCase().startsWith("invalid bip-39 passphrase"))?Z():U({message:"string"==typeof d?d:d.message})}})}signTransaction(t,n,i,o){return(0,g.mG)(this,void 0,void 0,function*(){const d=this.secretsService.findByPublicKey(t.publicKey);if(void 0===d)throw new Error("Secret not found");const u=yield this.secretsService.retrieveEntropyForSecret(d),h=W.entropyToMnemonic(u);return this.keyPairService.signWithProtocol(t.protocol,n,h,o,t.isExtendedPublicKey,t.derivationPath,yield this.getChildDerivationPath(t.derivationPath,null==i?void 0:i.derivationPath))})}signMessages(t,n="",i){var o,d,u;return(0,g.mG)(this,void 0,void 0,function*(){try{const h=yield Promise.all(t.map(T=>(0,g.mG)(this,void 0,void 0,function*(){var A;const v=yield this.signMessage(T.data,T.iacContext,n,T.wallet,i);return{type:"signed",id:T.id,protocol:null!==(A=T.protocol)&&void 0!==A?A:i,data:{message:T.data.message,publicKey:T.data.publicKey,signature:v,callbackURL:T.data.callbackURL},iacContext:T.iacContext,wallet:T.wallet,originalProtocolIdentifier:T.originalProtocolIdentifier}})));return $({messages:h})}catch(h){return console.warn(h),(null===(o=h.message)||void 0===o?void 0:o.toLowerCase().startsWith("secret not found"))?z():(null===(d=h.message)||void 0===d?void 0:d.toLowerCase().startsWith("protocol not found"))?de():(null===(u=h.message)||void 0===u?void 0:u.toLowerCase().startsWith("invalid bip-39 passphrase"))?Z():U({message:"string"==typeof h?h:h.message})}})}signMessage(t,n,i,o,d){var u;return(0,g.mG)(this,void 0,void 0,function*(){const h=void 0!==o&&null!==(u=this.secretsService.findByPublicKey(o.publicKey))&&void 0!==u?u:this.secretsService.getActiveSecret();if(void 0===h)throw new Error("Secret not found");const T=yield this.secretsService.retrieveEntropyForSecret(h),A=W.entropyToMnemonic(T);if(void 0!==o)return this.keyPairService.signWithProtocol(o.protocol,t,A,i,o.isExtendedPublicKey,o.derivationPath,yield this.getChildDerivationPath(o.derivationPath,null==n?void 0:n.derivationPath));{let v;try{v=void 0!==d?yield this.protocolService.getProtocol(d,void 0,!1):void 0}catch(O){console.warn(O),v=void 0}if(void 0===v)throw new Error("Protocol not found");return this.keyPairService.signWithProtocol(v,t,A,i,!1,yield v.getStandardDerivationPath(),yield this.getChildDerivationPath(yield v.getStandardDerivationPath(),null==n?void 0:n.derivationPath))}})}navigateWithSignedTransactions(t){return(0,g.mG)(this,void 0,void 0,function*(){const n=yield this.generateTransactionIACMessages(t);this.interactionService.startInteraction({operationType:w.jl.TRANSACTION_BROADCAST,iacMessage:n,wallets:t.map(i=>i.wallet),signedTxs:t.map(i=>i.data.transaction)})})}generateTransactionIACMessages(t){return(0,g.mG)(this,void 0,void 0,function*(){return yield Promise.all(t.map(i=>(0,g.mG)(this,void 0,void 0,function*(){var o;return{id:i.id,protocol:null!==(o=i.originalProtocolIdentifier)&&void 0!==o?o:yield i.wallet.protocol.getIdentifier(),type:m.IACMessageType.TransactionSignResponse,payload:{accountIdentifier:i.data.accountIdentifier,transaction:i.data.transaction,from:(0,l.Cw)(i.details,"from"),to:(0,l.Cw)(i.details,"to"),amount:(0,l.r9)(i.details,"amount"),fee:(0,l.r9)(i.details,"fee")}}})))})}navigateWithSignedMessages(t){return(0,g.mG)(this,void 0,void 0,function*(){const n=yield this.generateIACMessages(t);this.interactionService.startInteraction({operationType:w.jl.MESSAGE_SIGN_REQUEST,iacMessage:n,messageSignResponse:void 0!==t[0]?{message:t[0].data.message,publicKey:t[0].data.publicKey,signature:t[0].data.signature}:void 0})})}generateIACMessages(t){return(0,g.mG)(this,void 0,void 0,function*(){return t.map(i=>{var o;return{id:i.id,protocol:null!==(o=i.originalProtocolIdentifier)&&void 0!==o?o:i.protocol,type:m.IACMessageType.MessageSignResponse,payload:{message:i.data.message,publicKey:i.data.publicKey,signature:i.data.signature}}})})}checkIfSaplingTransaction(t,n){return(0,g.mG)(this,void 0,void 0,function*(){if(n===M.MainProtocolSymbols.XTZ)try{return(yield(yield this.getSaplingProtocol()).getTransactionDetails(t)).map(u=>u.to).reduce((u,h)=>u.concat(h),[]).some(u=>u.startsWith("zet")||"shielded pool"===u.toLocaleLowerCase())}catch(i){return console.error(i),!1}return n===M.MainProtocolSymbols.XTZ_SHIELDED})}getSaplingProtocol(){return(0,g.mG)(this,void 0,void 0,function*(){return yield this.protocolService.getProtocol(M.MainProtocolSymbols.XTZ_SHIELDED)})}getChildDerivationPath(t,n){return(0,g.mG)(this,void 0,void 0,function*(){if(!n)return;let i=n;if(i.startsWith("m")||(i=`m/${i}`),!i.startsWith(t))throw new Error("Derivation paths do not match!");return i.slice(t.length+1)})}}return s.\u0275fac=function(t){return new(t||s)(e.LFG(y.eX),e.LFG(r.yh),e.LFG(V.f),e.LFG(E.sK),e.LFG(l.dJ),e.LFG(Pe.R),e.LFG(l.OZ),e.LFG(l.pX),e.LFG(w.k3))},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac}),s})();var $e=c(4402),ze=c(31766),Ze=c(29416);class je{constructor(a,t){this.dueTime=a,this.scheduler=t}call(a,t){return t.subscribe(new Fe(a,this.dueTime,this.scheduler))}}class Fe extends ze.L{constructor(a,t,n){super(a),this.dueTime=t,this.scheduler=n,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(a){this.clearDebounce(),this.lastValue=a,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule(Ke,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:a}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(a)}}clearDebounce(){const a=this.debouncedSubscription;null!==a&&(this.remove(a),a.unsubscribe(),this.debouncedSubscription=null)}}function Ke(s){s.debouncedNext()}var Qe=c(51249),K=c(41530),S=c(55956),We=c(72867),He=c(91227),Be=c(5634),Te=c(53070);const qe={protocolIdentifier:void 0,airGapTxs:[],aggregatedDetails:void 0};let ye=(()=>{class s extends Be.m1{constructor(){super(qe),this.setAirGapTxs=this.updater((t,n)=>({protocolIdentifier:n[0].protocolIdentifier,airGapTxs:n,aggregatedDetails:{numberOfTxs:n.length,totalAmount:new Te.Z((0,l.r9)(n,"amount")),totalFees:new Te.Z((0,l.r9)(n,"fee"))}}))}selectProtocolIdentifier(){return this.select(t=>t.protocolIdentifier)}selectAirGapTxs(){return this.select(t=>t.airGapTxs)}selectAggregatedDetails(){return this.select(t=>t.aggregatedDetails)}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275prov=e.Yz7({token:s,factory:s.\u0275fac}),s})();var Je=c(62883);const Ye=function(s){return{protocol:s,maxDigits:void 0}},ke=function(s){return{protocol:s}};function Ve(s,a){if(1&s&&(e.ynx(0),e.TgZ(1,"ion-row",2)(2,"ion-col",3)(3,"h5"),e._uU(4),e.ALo(5,"async"),e.ALo(6,"amountConverter"),e.ALo(7,"async"),e.qZA()(),e.TgZ(8,"ion-col",3)(9,"h5"),e._uU(10),e.qZA()(),e.TgZ(11,"ion-col",3)(12,"h5"),e._uU(13),e.ALo(14,"async"),e.ALo(15,"feeConverter"),e.ALo(16,"async"),e.qZA()(),e.TgZ(17,"ion-col",4)(18,"small"),e._uU(19,"Amount"),e.qZA()(),e.TgZ(20,"ion-col",4)(21,"small"),e._uU(22,"Operations"),e.qZA()(),e.TgZ(23,"ion-col",4)(24,"small"),e._uU(25,"Fee"),e.qZA()()(),e.BQk()),2&s){const t=a.ngIf,n=e.oxw(2);e.xp6(4),e.hij(" ",e.lcZ(5,3,e.xi3(6,5,t.totalAmount.toFixed(),e.VKq(17,Ye,e.lcZ(7,8,n.protocolIdentifier$))))," "),e.xp6(6),e.Oqu(t.numberOfTxs),e.xp6(3),e.Oqu(e.lcZ(14,10,e.xi3(15,12,t.totalFees.toFixed(),e.VKq(19,ke,e.lcZ(16,15,n.protocolIdentifier$)))))}}function Xe(s,a){if(1&s&&(e.ynx(0),e._UZ(1,"airgap-transaction-warning",5)(2,"airgap-from-to",6),e.BQk()),2&s){const t=a.$implicit;e.xp6(1),e.Q6J("transaction",t),e.xp6(1),e.Q6J("transaction",t)("hideNetwork",!0)}}function et(s,a){if(1&s&&(e.ynx(0),e.YNc(1,Ve,26,21,"ng-container",0),e.ALo(2,"async"),e.YNc(3,Xe,3,3,"ng-container",1),e.BQk()),2&s){const t=a.ngIf,n=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,n.aggregatedDetails$)),e.xp6(2),e.Q6J("ngForOf",t)}}let tt=(()=>{class s{constructor(t,n){this.store=t,this.contactsService=n,this.protocolIdentifier$=this.store.selectProtocolIdentifier(),this.airGapTxs$=this.store.selectAirGapTxs(),this.aggregatedDetails$=this.store.selectAggregatedDetails()}ngOnInit(){return(0,g.mG)(this,void 0,void 0,function*(){void 0!==this.airGapTxs&&(yield this.setAddressNames(),this.store.setAirGapTxs(this.airGapTxs))})}ngOnChanges(){return(0,g.mG)(this,void 0,void 0,function*(){yield this.setAddressNames(),this.store.setAirGapTxs(this.airGapTxs)})}setAddressNames(){return(0,g.mG)(this,void 0,void 0,function*(){if(yield this.contactsService.isBookEnabled())for(let n=0;n<this.airGapTxs.length;n++){this.airGapTxs[n].extra={names:{}};for(let i=0;i<this.airGapTxs[n].from.length;i++){const o=this.airGapTxs[n].from[i],d=yield this.contactsService.getContactName(o);d&&(this.airGapTxs[n].extra.names[o]=d)}for(let i=0;i<this.airGapTxs[n].to.length;i++){const o=this.airGapTxs[n].to[i],d=yield this.contactsService.getContactName(o);d&&(this.airGapTxs[n].extra.names[o]=d)}}})}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(ye),e.Y36(He.P))},s.\u0275cmp=e.Xpm({type:s,selectors:[["airgap-transaction"]],inputs:{airGapTxs:"airGapTxs"},features:[e._Bn([ye]),e.TTD],decls:2,vars:3,consts:[[4,"ngIf"],[4,"ngFor","ngForOf"],[1,"ion-padding-bottom","ion-text-center"],["size","4",1,"content--align__center-center"],["size","4"],[3,"transaction"],[1,"ion-padding-horizontal",3,"transaction","hideNetwork"]],template:function(t,n){1&t&&(e.YNc(0,et,4,4,"ng-container",0),e.ALo(1,"async")),2&t&&e.Q6J("ngIf",e.lcZ(1,1,n.airGapTxs$))},directives:[D.O5,p.Nd,p.wI,D.sg,Je.p,l.j$],pipes:[D.Ov,l.Se,l.Ce],styles:[""]}),s})();function st(s,a){if(1&s&&(e.TgZ(0,"ion-row",2)(1,"ion-col",3)(2,"p"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"pre",4),e._uU(6),e.ALo(7,"json"),e.qZA()()()),2&s){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,2,"message-signing-request.payload_label")),e.xp6(3),e.Oqu(e.lcZ(7,4,t._messages[0].data))}}function nt(s,a){if(1&s&&(e.TgZ(0,"ion-row",5)(1,"ion-col",3)(2,"p"),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"pre",4),e._uU(6),e.qZA()()()),2&s){const t=e.oxw();e.xp6(3),e.Oqu(e.lcZ(4,2,"message-signing-request.blake2b_hash")),e.xp6(3),e.Oqu(t._messages[0].blake2bHash)}}let at=(()=>{class s{constructor(){}set messages(t){this._messages=t.map(n=>{const i=this.hexToReadable(n.data);return Object.assign(Object.assign({},n),{data:i})})}hexToReadable(t){try{return JSON.parse(t)}catch(n){}try{return(s=>{for(var a,t="",i=s.startsWith("0x")?2:0;i<s.length;i+=2)t+=String.fromCharCode(parseInt(s.substr(i,2),16));if((null===(a=t.match(/[^ A-Za-z0-9_@.,!?/#&+-\d\s:]/g))||void 0===a?void 0:a.length)>s.length/2/10)throw new Error("Probably not a human readable text encoded as hex.");return t})(t)}catch(n){}return t}}return s.\u0275fac=function(t){return new(t||s)},s.\u0275cmp=e.Xpm({type:s,selectors:[["airgap-message-sign-request"]],inputs:{messages:"messages"},decls:2,vars:2,consts:[["class","rawdata--container ion-padding-bottom",4,"ngIf"],["class","rawdata--container",4,"ngIf"],[1,"rawdata--container","ion-padding-bottom"],[1,"ion-no-padding"],[1,"ion-no-margin"],[1,"rawdata--container"]],template:function(t,n){1&t&&(e.YNc(0,st,8,6,"ion-row",0),e.YNc(1,nt,7,4,"ion-row",1)),2&t&&(e.Q6J("ngIf",n._messages[0]),e.xp6(1),e.Q6J("ngIf",n._messages[0].blake2bHash))},directives:[D.O5,p.Nd,p.wI],pipes:[E.X$,D.Ts],styles:[""]}),s})();const ot=function(s){return{secretLabel:s}};function rt(s,a){if(1&s&&(e.ynx(0),e._UZ(1,"p",5),e.ALo(2,"translate"),e._UZ(3,"airgap-account-item",6),e.BQk()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("innerHTML",e.xi3(2,2,"deserialized-detail.signing_account",e.VKq(5,ot,t.secretLabel)),e.oJD),e.xp6(2),e.Q6J("wallet",t.signingWallet)}}function lt(s,a){if(1&s&&(e.ynx(0),e._UZ(1,"airgap-transaction",7),e.ALo(2,"async"),e.BQk()),2&s){const t=e.oxw(2);e.xp6(1),e.Q6J("airGapTxs",e.lcZ(2,1,t.transactionsDetails$).value)}}function ct(s,a){if(1&s&&(e.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col",8),e._UZ(3,"ion-icon",9),e.qZA(),e.TgZ(4,"ion-col",10),e._uU(5),e.ALo(6,"translate"),e.qZA()(),e.TgZ(7,"ion-row")(8,"ion-col",11)(9,"ion-text")(10,"p",12),e._uU(11),e.ALo(12,"async"),e.qZA()()()()()),2&s){const t=e.oxw(2);e.xp6(5),e.Oqu(e.lcZ(6,2,"deserialized-detail.transaction.unreadable_warning")),e.xp6(6),e.Oqu(e.lcZ(12,4,t.rawData$).value)}}function dt(s,a){if(1&s&&(e.ynx(0),e.YNc(1,lt,3,3,"ng-container",3),e.ALo(2,"async"),e.YNc(3,ct,13,6,"ion-grid",3),e.ALo(4,"async"),e.ALo(5,"async"),e.BQk()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,2,t.transactionsDetails$).status===t.UIResourceStatus.SUCCESS),e.xp6(2),e.Q6J("ngIf",e.lcZ(4,4,t.transactionsDetails$).status===t.UIResourceStatus.ERROR&&e.lcZ(5,6,t.rawData$).status===t.UIResourceStatus.SUCCESS)}}function ut(s,a){if(1&s&&(e.ynx(0),e._UZ(1,"airgap-message-sign-request",13),e.ALo(2,"async"),e.BQk()),2&s){const t=e.oxw(2);e.xp6(1),e.Q6J("messages",e.lcZ(2,1,t.messages$).value)}}function gt(s,a){if(1&s&&(e.ynx(0),e.YNc(1,ut,3,3,"ng-container",3),e.ALo(2,"async"),e.BQk()),2&s){const t=e.oxw();e.xp6(1),e.Q6J("ngIf",e.lcZ(2,1,t.messages$).status===t.UIResourceStatus.SUCCESS)}}function ht(s,a){if(1&s){const t=e.EpF();e.TgZ(0,"ion-fab",14)(1,"ion-button",15),e.NdJ("click",function(){return e.CHM(t),e.oxw().continue()}),e._UZ(2,"ion-icon",16),e._uU(3),e.qZA()()}if(2&s){const t=a.ngIf;e.xp6(3),e.hij(" ",t," ")}}const pt=[{path:"",component:(()=>{class s{constructor(t,n,i,o){this.store=t,this.uiEventService=n,this.modalController=i,this.navigationService=o,this.Mode=P,this.UIResourceStatus=l.Tq,this.ngDestroyed$=new $e.xQ;const d=this.navigationService.getState();if(d.transactionInfos&&d.transactionInfos[0]){const u=d.transactionInfos;this.signingWallet=u[0].wallet,this.secretLabel=u[0].secret.label}this.mode$=this.store.select(G),this.title$=this.store.select(Ee),this.button$=this.store.select(Me),this.loader$=this.store.select(Ce),this.alert$=this.store.select(Oe),this.modal$=this.store.select(Ne),this.transactionsDetails$=this.store.select(Ge),this.messages$=this.store.select(_e),this.rawData$=this.store.select(we),this.loader$.pipe(function Ue(s,a=Ze.P){return t=>t.lift(new je(s,a))}(0),(0,Qe.x)(),(0,K.R)(this.ngDestroyed$)).subscribe(this.showOrHideLoader.bind(this)),this.alert$.pipe((0,K.R)(this.ngDestroyed$)).subscribe(this.showOrDismissAlert.bind(this)),this.modal$.pipe((0,K.R)(this.ngDestroyed$)).subscribe(this.showOrDismissModal.bind(this)),this.store.dispatch(X())}ngOnDestroy(){this.ngDestroyed$.next(),this.ngDestroyed$.complete()}continue(){this.store.dispatch(ne())}showOrHideLoader(t){var n;return(0,g.mG)(this,void 0,void 0,function*(){null===(n=this.loadingElement)||void 0===n||n.dismiss().catch((0,S.a1)(S.qj.IONIC_LOADER)),(null==t?void 0:t.status)===l.vQ.PENDING?(this.loadingElement=yield this.uiEventService.getTranslatedLoader(this.getLoaderData(t.value)),yield this.loadingElement.present().catch((0,S.a1)(S.qj.IONIC_LOADER)),this.store.dispatch(ie({userInput:t.userInput}))):this.loadingElement=void 0})}showOrDismissAlert(t){var n;return(0,g.mG)(this,void 0,void 0,function*(){if(null===(n=this.alertElement)||void 0===n||n.dismiss().catch((0,S.a1)(S.qj.IONIC_ALERT)),(null==t?void 0:t.status)===l.vQ.PENDING)return this.alertElement=yield this.uiEventService.getTranslatedAlert(this.getAlertData(t.value)),this.alertElement.present().catch((0,S.a1)(S.qj.IONIC_ALERT)),this.alertElement.onWillDismiss().then(()=>{this.store.dispatch(ae({id:t.id}))}).catch((0,S.a1)(S.qj.IONIC_ALERT));this.alertElement=void 0})}showOrDismissModal(t){var n;return(0,g.mG)(this,void 0,void 0,function*(){if(null===(n=this.modalElement)||void 0===n||n.dismiss().catch((0,S.a1)(S.qj.IONIC_MODAL)),(null==t?void 0:t.status)===l.vQ.PENDING){const[i,o]=this.getModalData(t.value);return this.modalElement=yield this.modalController.create(i),this.modalElement.present().catch((0,S.a1)(S.qj.IONIC_MODAL)),this.modalElement.onWillDismiss().then(d=>(this.store.dispatch(oe({id:t.id})),o(d))).catch((0,S.a1)(S.qj.IONIC_MODAL))}this.modalElement=void 0})}getLoaderData(t){switch(t){case"signTransaction":return this.signTransactionLoader();case"signMessage":return this.signMessageLoader();case"generic":return this.genericLoader();default:(0,l.vE)("getLoaderData",t)}}signTransactionLoader(){return{message:"deserialized-detail.loader.sign-transaction.message"}}signMessageLoader(){return{message:"deserialized-detail.loader.sign-message.message"}}genericLoader(){return{message:"deserialized-detail.loader.generic.message"}}getAlertData(t){switch(t.type){case"bip39Passphrase":return this.bip39PassphraseAlert();case"bip39PassphraseError":return this.bip39PassphraseErrorAlert();case"secretNotFound":return this.secretNotFoundErrorAlert();case"unknownError":return this.unknownErrorAlert(t.message);default:(0,l.vE)("getAlertData",t)}}bip39PassphraseAlert(){return{header:"deserialized-detail.alert.bip39-passphrase.header",message:"deserialized-detail.alert.bip39-passphrase.message",backdropDismiss:!1,inputs:[{name:"bip39Passphrase",type:"password",placeholder:"deserialized-detail.alert.bip39-passphrase.input-placeholder_label"}],buttons:[{text:"deserialized-detail.alert.bip39-passphrase.button_label",handler:t=>(0,g.mG)(this,void 0,void 0,function*(){var n;const i=null!==(n=t.bip39Passphrase)&&void 0!==n?n:"";this.store.dispatch(re({passphrase:i}))})}]}}bip39PassphraseErrorAlert(){return{header:"deserialized-detail.alert.bip39-passphrase-error.header",message:"deserialized-detail.alert.bip39-passphrase-error.message",backdropDismiss:!1,buttons:[{text:"deserialized-detail.alert.bip39-passphrase-error.button_label"}]}}secretNotFoundErrorAlert(){return{header:"deserialized-detail.alert.secret-not-found-error.header",message:"deserialized-detail.alert.secret-not-found-error.message",backdropDismiss:!1,buttons:[{text:"deserialized-detail.alert.secret-not-found-error.button_label"}]}}unknownErrorAlert(t){return{header:"deserialized-detail.alert.unknown-error.header",message:null!=t?t:"deserialized-detail.alert.unknown-error.message",backdropDismiss:!0,buttons:[{text:"deserialized-detail.alert.unknown-error.button_label"}]}}getModalData(t){if("selectSigningAccount"===t)return this.selectSigningAccountModal();(0,l.vE)("getModalData",t)}selectSigningAccountModal(){return[{component:We.q,componentProps:{type:"message-signing"}},i=>(0,g.mG)(this,void 0,void 0,function*(){void 0===i.data||"string"!=typeof i.data||this.store.dispatch(le({protocol:i.data}))})]}}return s.\u0275fac=function(t){return new(t||s)(e.Y36(r.yh),e.Y36(l.Ax),e.Y36(p.IN),e.Y36(V.f))},s.\u0275cmp=e.Xpm({type:s,selectors:[["airgap-deserialized-detail"]],decls:15,vars:13,consts:[[1,"ion-no-border"],["slot","start"],[1,"deserialized-content","ion-padding"],[4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed",4,"ngIf"],[3,"innerHTML"],[3,"wallet"],[3,"airGapTxs"],["size","2",1,"ion-margin-top"],["color","white","src","assets/icons/md-warning.svg",1,"warning-icon"],["size","10"],["size","12"],[1,"text--selectable","typography--mono","word-break__all"],[3,"messages"],["vertical","bottom","horizontal","end","slot","fixed"],["color","primary","shape","round",3,"click"],["slot","start","src","assets/icons/md-check.svg"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header",0)(1,"ion-toolbar")(2,"ion-buttons",1),e._UZ(3,"ion-back-button"),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5),e.ALo(6,"async"),e.qZA()()(),e.TgZ(7,"ion-content",2),e.YNc(8,rt,4,7,"ng-container",3),e.YNc(9,dt,6,8,"ng-container",3),e.ALo(10,"async"),e.YNc(11,gt,3,3,"ng-container",3),e.ALo(12,"async"),e.YNc(13,ht,4,1,"ion-fab",4),e.ALo(14,"async"),e.qZA()),2&t&&(e.xp6(5),e.Oqu(e.lcZ(6,5,n.title$)),e.xp6(3),e.Q6J("ngIf",void 0!==n.signingWallet),e.xp6(1),e.Q6J("ngIf",e.lcZ(10,7,n.mode$)===n.Mode.SIGN_TRANSACTION),e.xp6(2),e.Q6J("ngIf",e.lcZ(12,9,n.mode$)===n.Mode.SIGN_MESSAGE),e.xp6(2),e.Q6J("ngIf",e.lcZ(14,11,n.button$)))},directives:[p.Gu,p.sr,p.Sm,p.oU,p.cs,p.wd,p.W2,D.O5,l.vq,tt,p.jY,p.Nd,p.wI,p.gu,p.yW,at,p.IJ,p.YG],pipes:[D.Ov,E.X$],styles:[".warning-icon[_ngcontent-%COMP%]{font-size:4rem}.word-break__all[_ngcontent-%COMP%]{word-break:break-all}.deserialized-content[_ngcontent-%COMP%]{--margin-bottom: 32px;margin-bottom:32px}ion-content[_ngcontent-%COMP%]{--padding-bottom: var(--ion-padding, 64px)}"]}),s})()}];let vt=(()=>{class s{}return s.\u0275fac=function(t){return new(t||s)},s.\u0275mod=e.oAB({type:s}),s.\u0275inj=e.cJS({imports:[[D.ez,L.K,C.u5,p.Pc,b.Bz.forChild(pt),E.aw,r.Aw.forFeature("deserializedDetail",xe),y.sQ.forFeature([Re]),l.aD]]}),s})()},51628:(Q,x,c)=>{c.d(x,{D:()=>C});var D=c(9288);let C=(()=>{class b{}return b.\u0275fac=function(y){return new(y||b)},b.\u0275mod=D.oAB({type:b}),b.\u0275inj=D.cJS({imports:[[]]}),b})()}}]);